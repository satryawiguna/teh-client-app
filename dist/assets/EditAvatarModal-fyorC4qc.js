import{x as Jt,A as Ci,y as ni,r as Ke,g as Si,i as Zt,a as $t,f as wi,b as xi,e as ei,j as Ge,z as Pi,Q as Ai}from"./index-FqGtBFJ_.js";import{M as ti}from"./index.esm-tyU5CQBU.js";import{m as ki}from"./index-p1UXWbwx.js";import{g as Ei,h as ii}from"./AdminLayout-8TZdXObN.js";import{u as Ii}from"./useDispatch-MackedKD.js";var Ti={VITE_APP_NAME:"TehGroupClient",VITE_APP_VERSION:"v1.0",VITE_BASE_APP_URL:"https://teh-erp-event-crm-dev-f009581783a1.herokuapp.com",VITE_BASE_API_URL:"https://teh-erp-api-dev-a206927ee388.herokuapp.com/api",VITE_CLIENT_APP_URL:"https://teh-erp-client-dev-f009581783a1.herokuapp.com",VITE_MASTER_APP_URL:"https://teh-erp-master-dev-9af9bf8ea050.herokuapp.com",VITE_HR_APP_URL:"https://teh-erp-hr-dev-37843a26b1f5.herokuapp.com",VITE_EVENT_CRM_APP_URL:"https://teh-erp-event-crm-dev-f009581783a1.herokuapp.com",VITE_FINANCE_APP_URL:"",VITE_SALE_APP_URL:"",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};class ai{static async uploadAvatar(ye){const Se=new Jt.Configuration({apiKey:`${Ti.VITE_ELASTIC_EMAIL_API_KEY}`});return await new Jt.FilesApi(Se).filesPost(ye).catch(()=>Promise.reject(ye))}static async updateAvatar(ye){const[Se,we]=ye;return(await Ci("identity").put(`/users/${Se}/avatars`,we)).data}}const Di=(ve,ye)=>ni({mutationFn:ai.uploadAvatar,onSuccess:ve,onError:ye}),Ri=(ve,ye)=>ni({mutationFn:ai.updateAvatar,onSuccess:ve,onError:ye});var si={exports:{}};(function(ve,ye){(function(Se,we){ve.exports=we(Ke)})(self,function(Se){return(()=>{var we={303:(V,Y,q)=>{V.exports=q(302),q(200),q(630),q(16),q(677),q(635),q(166),q(140),q(922)},635:(V,Y,q)=>{var j,G,K;(function(re){G=[q(302),q(677)],(K=typeof(j=function(L){var N=L.ExifMap.prototype;N.tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",34665:{36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",36880:"OffsetTime",36881:"OffsetTimeOriginal",36882:"OffsetTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber"},34853:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},40965:{1:"InteroperabilityIndex"}},N.tags.ifd1=N.tags,N.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"Original",2:"Horizontal flip",3:"Rotate 180° CCW",4:"Vertical flip",5:"Vertical flip + Rotate 90° CW",6:"Rotate 90° CW",7:"Horizontal flip + Rotate 90° CW",8:"Rotate 90° CCW"}},N.getText=function(S){var C=this.get(S);switch(S){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[S][C];case"ExifVersion":case"FlashpixVersion":return C?String.fromCharCode(C[0],C[1],C[2],C[3]):void 0;case"ComponentsConfiguration":return C?this.stringValues[S][C[0]]+this.stringValues[S][C[1]]+this.stringValues[S][C[2]]+this.stringValues[S][C[3]]:void 0;case"GPSVersionID":return C?C[0]+"."+C[1]+"."+C[2]+"."+C[3]:void 0}return String(C)},N.getAll=function(){var S,C,B,O={};for(S in this)Object.prototype.hasOwnProperty.call(this,S)&&((C=this[S])&&C.getAll?O[this.ifds[S].name]=C.getAll():(B=this.tags[S])&&(O[B]=this.getText(B)));return O},N.getName=function(S){var C=this.tags[S];return typeof C=="object"?this.ifds[S].name:C},function(){var S,C,B,O=N.tags;for(S in O)if(Object.prototype.hasOwnProperty.call(O,S))if(C=N.ifds[S])for(S in B=O[S])Object.prototype.hasOwnProperty.call(B,S)&&(C.map[B[S]]=Number(S));else N.map[O[S]]=Number(S)}()})=="function"?j.apply(Y,G):j)===void 0||(V.exports=K)})()},677:(V,Y,q)=>{var j,G,K;(function(re){G=[q(302),q(630)],(K=typeof(j=function(L){function N(A){A&&(Object.defineProperty(this,"map",{value:this.ifds[A].map}),Object.defineProperty(this,"tags",{value:this.tags&&this.tags[A]||{}}))}N.prototype.map={Orientation:274,Thumbnail:"ifd1",Blob:513,Exif:34665,GPSInfo:34853,Interoperability:40965},N.prototype.ifds={ifd1:{name:"Thumbnail",map:N.prototype.map},34665:{name:"Exif",map:{}},34853:{name:"GPSInfo",map:{}},40965:{name:"Interoperability",map:{}}},N.prototype.get=function(A){return this[A]||this[this.map[A]]};var S={1:{getValue:function(A,d){return A.getUint8(d)},size:1},2:{getValue:function(A,d){return String.fromCharCode(A.getUint8(d))},size:1,ascii:!0},3:{getValue:function(A,d,P){return A.getUint16(d,P)},size:2},4:{getValue:function(A,d,P){return A.getUint32(d,P)},size:4},5:{getValue:function(A,d,P){return A.getUint32(d,P)/A.getUint32(d+4,P)},size:8},9:{getValue:function(A,d,P){return A.getInt32(d,P)},size:4},10:{getValue:function(A,d,P){return A.getInt32(d,P)/A.getInt32(d+4,P)},size:8}};function C(A,d,P,f,k,R){var x,m,p,u,_,b,w=S[f];if(w){if(!((m=(x=w.size*k)>4?d+A.getUint32(P+8,R):P+8)+x>A.byteLength)){if(k===1)return w.getValue(A,m,R);for(p=[],u=0;u<k;u+=1)p[u]=w.getValue(A,m+u*w.size,R);if(w.ascii){for(_="",u=0;u<p.length&&(b=p[u])!=="\0";u+=1)_+=b;return _}return p}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")}function B(A,d,P){return(!A||A[P])&&(!d||d[P]!==!0)}function O(A,d,P,f,k,R,x,m){var p,u,_,b,w,I;if(P+6>A.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(!((u=P+2+12*(p=A.getUint16(P,f)))+4>A.byteLength)){for(_=0;_<p;_+=1)b=P+2+12*_,B(x,m,w=A.getUint16(b,f))&&(I=C(A,d,b,A.getUint16(b+2,f),A.getUint32(b+4,f),f),k[w]=I,R&&(R[w]=b));return A.getUint32(u,f)}console.log("Invalid Exif data: Invalid directory size.")}}S[7]=S[1],L.parseExifData=function(A,d,P,f,k){if(!k.disableExif){var R,x,m,p=k.includeExifTags,u=k.excludeExifTags||{34665:{37500:!0}},_=d+10;if(A.getUint32(d+4)===1165519206)if(_+8>A.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(A.getUint16(d+8)===0){switch(A.getUint16(_)){case 18761:R=!0;break;case 19789:R=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}A.getUint16(_+2,R)===42?(x=A.getUint32(_+4,R),f.exif=new N,k.disableExifOffsets||(f.exifOffsets=new N,f.exifTiffOffset=_,f.exifLittleEndian=R),(x=O(A,_,_+x,R,f.exif,f.exifOffsets,p,u))&&B(p,u,"ifd1")&&(f.exif.ifd1=x,f.exifOffsets&&(f.exifOffsets.ifd1=_+x)),Object.keys(f.exif.ifds).forEach(function(b){(function(w,I,T,M,z,Q,J){var H=w.exif[I];H&&(w.exif[I]=new N(I),w.exifOffsets&&(w.exifOffsets[I]=new N(I)),O(T,M,M+H,z,w.exif[I],w.exifOffsets&&w.exifOffsets[I],Q&&Q[I],J&&J[I]))})(f,b,A,_,R,p,u)}),(m=f.exif.ifd1)&&m[513]&&(m[513]=function(b,w,I){if(I){if(!(w+I>b.byteLength))return new Blob([L.bufferSlice.call(b.buffer,w,w+I)],{type:"image/jpeg"});console.log("Invalid Exif data: Invalid thumbnail data.")}}(A,_+m[513],m[514]))):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},L.metaDataParsers.jpeg[65505].push(L.parseExifData),L.exifWriters={274:function(A,d,P){var f=d.exifOffsets[274];return f&&new DataView(A,f+8,2).setUint16(0,P,d.exifLittleEndian),A}},L.writeExifData=function(A,d,P,f){return L.exifWriters[d.exif.map[P]](A,d,f)},L.ExifMap=N})=="function"?j.apply(Y,G):j)===void 0||(V.exports=K)})()},16:(V,Y,q)=>{var j,G,K;(function(re){G=[q(302)],(K=typeof(j=function(L){var N=L.global;N.fetch&&N.Request&&N.Response&&N.Response.prototype.blob?L.fetchBlob=function(S,C,B){function O(A){return A.blob()}if(N.Promise&&typeof C!="function")return fetch(new Request(S,C)).then(O);fetch(new Request(S,B)).then(O).then(C).catch(function(A){C(null,A)})}:N.XMLHttpRequest&&new XMLHttpRequest().responseType===""&&(L.fetchBlob=function(S,C,B){function O(A,d){B=B||{};var P=new XMLHttpRequest;P.open(B.method||"GET",S),B.headers&&Object.keys(B.headers).forEach(function(f){P.setRequestHeader(f,B.headers[f])}),P.withCredentials=B.credentials==="include",P.responseType="blob",P.onload=function(){A(P.response)},P.onerror=P.onabort=P.ontimeout=function(f){A===d?d(null,f):d(f)},P.send(B.body)}return N.Promise&&typeof C!="function"?(B=C,new Promise(O)):O(C,C)})})=="function"?j.apply(Y,G):j)===void 0||(V.exports=K)})()},140:(V,Y,q)=>{var j,G,K;(function(re){G=[q(302),q(166)],(K=typeof(j=function(L){var N=L.IptcMap.prototype;N.tags={0:"ApplicationRecordVersion",3:"ObjectTypeReference",4:"ObjectAttributeReference",5:"ObjectName",7:"EditStatus",8:"EditorialUpdate",10:"Urgency",12:"SubjectReference",15:"Category",20:"SupplementalCategories",22:"FixtureIdentifier",25:"Keywords",26:"ContentLocationCode",27:"ContentLocationName",30:"ReleaseDate",35:"ReleaseTime",37:"ExpirationDate",38:"ExpirationTime",40:"SpecialInstructions",42:"ActionAdvised",45:"ReferenceService",47:"ReferenceDate",50:"ReferenceNumber",55:"DateCreated",60:"TimeCreated",62:"DigitalCreationDate",63:"DigitalCreationTime",65:"OriginatingProgram",70:"ProgramVersion",75:"ObjectCycle",80:"Byline",85:"BylineTitle",90:"City",92:"Sublocation",95:"State",100:"CountryCode",101:"Country",103:"OriginalTransmissionReference",105:"Headline",110:"Credit",115:"Source",116:"CopyrightNotice",118:"Contact",120:"Caption",121:"LocalCaption",122:"Writer",125:"RasterizedCaption",130:"ImageType",131:"ImageOrientation",135:"LanguageIdentifier",150:"AudioType",151:"AudioSamplingRate",152:"AudioSamplingResolution",153:"AudioDuration",154:"AudioOutcue",184:"JobID",185:"MasterDocumentID",186:"ShortDocumentID",187:"UniqueDocumentID",188:"OwnerID",200:"ObjectPreviewFileFormat",201:"ObjectPreviewFileVersion",202:"ObjectPreviewData",221:"Prefs",225:"ClassifyState",228:"SimilarityIndex",230:"DocumentNotes",231:"DocumentHistory",232:"ExifCameraInfo",255:"CatalogSets"},N.stringValues={10:{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"},75:{a:"Morning",b:"Both Morning and Evening",p:"Evening"},131:{L:"Landscape",P:"Portrait",S:"Square"}},N.getText=function(S){var C=this.get(S),B=this.map[S],O=this.stringValues[B];return O?O[C]:String(C)},N.getAll=function(){var S,C,B={};for(S in this)Object.prototype.hasOwnProperty.call(this,S)&&(C=this.tags[S])&&(B[C]=this.getText(C));return B},N.getName=function(S){return this.tags[S]},function(){var S,C=N.tags,B=N.map||{};for(S in C)Object.prototype.hasOwnProperty.call(C,S)&&(B[C[S]]=Number(S))}()})=="function"?j.apply(Y,G):j)===void 0||(V.exports=K)})()},166:(V,Y,q)=>{var j,G,K;(function(re){G=[q(302),q(630)],(K=typeof(j=function(L){function N(){}function S(d,P,f,k,R){return P.types[d]==="binary"?new Blob([f.buffer.slice(k,k+R)]):P.types[d]==="Uint16"?f.getUint16(k):function(x,m,p){for(var u="",_=m+p,b=m;b<_;b+=1)u+=String.fromCharCode(x.getUint8(b));return u}(f,k,R)}function C(d,P){return d===void 0?P:d instanceof Array?(d.push(P),d):[d,P]}function B(d,P,f,k,R,x){for(var m,p,u,_=P+f,b=P;b<_;)d.getUint8(b)===28&&d.getUint8(b+1)===2&&(u=d.getUint8(b+2),R&&!R[u]||x&&x[u]||(p=d.getInt16(b+3),m=S(u,k.iptc,d,b+5,p),k.iptc[u]=C(k.iptc[u],m),k.iptcOffsets&&(k.iptcOffsets[u]=b))),b+=1}function O(d,P){return d.getUint32(P)===943868237&&d.getUint16(P+4)===1028}function A(d,P){var f=d.getUint8(P+7);return f%2!=0&&(f+=1),f===0&&(f=4),f}N.prototype.map={ObjectName:5},N.prototype.types={0:"Uint16",200:"Uint16",201:"Uint16",202:"binary"},N.prototype.get=function(d){return this[d]||this[this.map[d]]},L.parseIptcData=function(d,P,f,k,R){if(!R.disableIptc)for(var x=P+f;P+8<x;){if(O(d,P)){var m=A(d,P),p=P+8+m;if(p>x){console.log("Invalid IPTC data: Invalid segment offset.");break}var u=d.getUint16(P+6+m);if(P+u>x){console.log("Invalid IPTC data: Invalid segment size.");break}return k.iptc=new N,R.disableIptcOffsets||(k.iptcOffsets=new N),void B(d,p,u,k,R.includeIptcTags,R.excludeIptcTags||{202:!0})}P+=1}},L.metaDataParsers.jpeg[65517].push(L.parseIptcData),L.IptcMap=N})=="function"?j.apply(Y,G):j)===void 0||(V.exports=K)})()},630:(V,Y,q)=>{var j,G,K;(function(re){G=[q(302)],(K=typeof(j=function(L){var N=L.global,S=L.transform,C=N.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),B=N.ArrayBuffer&&ArrayBuffer.prototype.slice||function(P,f){f=f||this.byteLength-P;var k=new Uint8Array(this,P,f),R=new Uint8Array(f);return R.set(k),R.buffer},O={jpeg:{65505:[],65517:[]}};function A(P,f,k,R){var x=this;function m(p,u){if(!(N.DataView&&C&&P&&P.size>=12&&P.type==="image/jpeg"))return p(R);var _=k.maxMetaDataSize||262144;L.readFile(C.call(P,0,_),function(b){var w=new DataView(b);if(w.getUint16(0)!==65496)return u(new Error("Invalid JPEG file: Missing JPEG marker."));for(var I,T,M,z,Q=2,J=w.byteLength-4,H=Q;Q<J&&((I=w.getUint16(Q))>=65504&&I<=65519||I===65534);){if(Q+(T=w.getUint16(Q+2)+2)>w.byteLength){console.log("Invalid JPEG metadata: Invalid segment size.");break}if((M=O.jpeg[I])&&!k.disableMetaDataParsers)for(z=0;z<M.length;z+=1)M[z].call(x,w,Q,T,R,k);H=Q+=T}!k.disableImageHead&&H>6&&(R.imageHead=B.call(b,0,H)),p(R)},u,"readAsArrayBuffer")||p(R)}return k=k||{},N.Promise&&typeof f!="function"?(R=k=f||{},new Promise(m)):(R=R||{},m(f,f))}function d(P,f,k){return P&&f&&k?new Blob([k,C.call(P,f.byteLength)],{type:"image/jpeg"}):null}L.transform=function(P,f,k,R,x){L.requiresMetaData(f)?A(R,function(m){m!==x&&(N.console&&console.log(m),m=x),S.call(L,P,f,k,R,m)},f,x=x||{}):S.apply(L,arguments)},L.blobSlice=C,L.bufferSlice=B,L.replaceHead=function(P,f,k){var R={maxMetaDataSize:256,disableMetaDataParsers:!0};if(!k&&N.Promise)return A(P,R).then(function(x){return d(P,x.imageHead,f)});A(P,function(x){k(d(P,x.imageHead,f))},R)},L.parseMetaData=A,L.metaDataParsers=O})=="function"?j.apply(Y,G):j)===void 0||(V.exports=K)})()},922:(V,Y,q)=>{var j,G,K;(function(re){G=[q(302),q(200),q(630)],(K=typeof(j=function(L){var N=L.transform,S=L.requiresCanvas,C=L.requiresMetaData,B=L.transformCoordinates,O=L.getTransformedOptions;function A(f,k){var R=f&&f.orientation;return R===!0&&!L.orientation||R===1&&L.orientation||(!k||L.orientation)&&R>1&&R<9}function d(f,k){return f!==k&&(f===1&&k>1&&k<9||f>1&&f<9)}function P(f,k){if(k>1&&k<9)switch(f){case 2:case 4:return k>4;case 5:case 7:return k%2==0;case 6:case 8:return k===2||k===4||k===5||k===7}return!1}(function(f){if(f.global.document){var k=document.createElement("img");k.onload=function(){if(f.orientation=k.width===2&&k.height===3,f.orientation){var R=f.createCanvas(1,1,!0).getContext("2d");R.drawImage(k,1,1,1,1,0,0,1,1),f.orientationCropBug=R.getImageData(0,0,1,1).data.toString()!=="255,255,255,255"}},k.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k="}})(L),L.requiresCanvas=function(f){return A(f)||S.call(L,f)},L.requiresMetaData=function(f){return A(f,!0)||C.call(L,f)},L.transform=function(f,k,R,x,m){N.call(L,f,k,function(p,u){if(u){var _=L.orientation&&u.exif&&u.exif.get("Orientation");if(_>4&&_<9){var b=u.originalWidth,w=u.originalHeight;u.originalWidth=w,u.originalHeight=b}}R(p,u)},x,m)},L.getTransformedOptions=function(f,k,R){var x=O.call(L,f,k),m=R.exif&&R.exif.get("Orientation"),p=x.orientation,u=L.orientation&&m;if(p===!0&&(p=m),!d(p,u))return x;var _=x.top,b=x.right,w=x.bottom,I=x.left,T={};for(var M in x)Object.prototype.hasOwnProperty.call(x,M)&&(T[M]=x[M]);if(T.orientation=p,(p>4&&!(u>4)||p<5&&u>4)&&(T.maxWidth=x.maxHeight,T.maxHeight=x.maxWidth,T.minWidth=x.minHeight,T.minHeight=x.minWidth,T.sourceWidth=x.sourceHeight,T.sourceHeight=x.sourceWidth),u>1){switch(u){case 2:b=x.left,I=x.right;break;case 3:_=x.bottom,b=x.left,w=x.top,I=x.right;break;case 4:_=x.bottom,w=x.top;break;case 5:_=x.left,b=x.bottom,w=x.right,I=x.top;break;case 6:_=x.left,b=x.top,w=x.right,I=x.bottom;break;case 7:_=x.right,b=x.top,w=x.left,I=x.bottom;break;case 8:_=x.right,b=x.bottom,w=x.left,I=x.top}if(P(p,u)){var z=_,Q=b;_=w,b=I,w=z,I=Q}}switch(T.top=_,T.right=b,T.bottom=w,T.left=I,p){case 2:T.right=I,T.left=b;break;case 3:T.top=w,T.right=I,T.bottom=_,T.left=b;break;case 4:T.top=w,T.bottom=_;break;case 5:T.top=I,T.right=w,T.bottom=b,T.left=_;break;case 6:T.top=b,T.right=w,T.bottom=I,T.left=_;break;case 7:T.top=b,T.right=_,T.bottom=I,T.left=w;break;case 8:T.top=I,T.right=_,T.bottom=b,T.left=w}return T},L.transformCoordinates=function(f,k,R){B.call(L,f,k,R);var x=k.orientation,m=L.orientation&&R.exif&&R.exif.get("Orientation");if(d(x,m)){var p=f.getContext("2d"),u=f.width,_=f.height,b=u,w=_;switch((x>4&&!(m>4)||x<5&&m>4)&&(f.width=_,f.height=u),x>4&&(b=_,w=u),m){case 2:p.translate(b,0),p.scale(-1,1);break;case 3:p.translate(b,w),p.rotate(Math.PI);break;case 4:p.translate(0,w),p.scale(1,-1);break;case 5:p.rotate(-.5*Math.PI),p.scale(-1,1);break;case 6:p.rotate(-.5*Math.PI),p.translate(-b,0);break;case 7:p.rotate(-.5*Math.PI),p.translate(-b,w),p.scale(1,-1);break;case 8:p.rotate(.5*Math.PI),p.translate(0,-w)}switch(P(x,m)&&(p.translate(b,w),p.rotate(Math.PI)),x){case 2:p.translate(u,0),p.scale(-1,1);break;case 3:p.translate(u,_),p.rotate(Math.PI);break;case 4:p.translate(0,_),p.scale(1,-1);break;case 5:p.rotate(.5*Math.PI),p.scale(1,-1);break;case 6:p.rotate(.5*Math.PI),p.translate(0,-_);break;case 7:p.rotate(.5*Math.PI),p.translate(u,-_),p.scale(-1,1);break;case 8:p.rotate(-.5*Math.PI),p.translate(-u,0)}}}})=="function"?j.apply(Y,G):j)===void 0||(V.exports=K)})()},200:(V,Y,q)=>{var j,G,K;(function(re){G=[q(302)],(K=typeof(j=function(L){var N=L.transform;L.createCanvas=function(S,C,B){if(B&&L.global.OffscreenCanvas)return new OffscreenCanvas(S,C);var O=document.createElement("canvas");return O.width=S,O.height=C,O},L.transform=function(S,C,B,O,A){N.call(L,L.scale(S,C,A),C,B,O,A)},L.transformCoordinates=function(){},L.getTransformedOptions=function(S,C){var B,O,A,d,P=C.aspectRatio;if(!P)return C;for(O in B={},C)Object.prototype.hasOwnProperty.call(C,O)&&(B[O]=C[O]);return B.crop=!0,(A=S.naturalWidth||S.width)/(d=S.naturalHeight||S.height)>P?(B.maxWidth=d*P,B.maxHeight=d):(B.maxWidth=A,B.maxHeight=A/P),B},L.drawImage=function(S,C,B,O,A,d,P,f,k){var R=C.getContext("2d");return k.imageSmoothingEnabled===!1?(R.msImageSmoothingEnabled=!1,R.imageSmoothingEnabled=!1):k.imageSmoothingQuality&&(R.imageSmoothingQuality=k.imageSmoothingQuality),R.drawImage(S,B,O,A,d,0,0,P,f),R},L.requiresCanvas=function(S){return S.canvas||S.crop||!!S.aspectRatio},L.scale=function(S,C,B){C=C||{},B=B||{};var O,A,d,P,f,k,R,x,m,p,u,_,b=S.getContext||L.requiresCanvas(C)&&!!L.global.HTMLCanvasElement,w=S.naturalWidth||S.width,I=S.naturalHeight||S.height,T=w,M=I;function z(){var J=Math.max((d||T)/T,(P||M)/M);J>1&&(T*=J,M*=J)}function Q(){var J=Math.min((O||T)/T,(A||M)/M);J<1&&(T*=J,M*=J)}if(b&&(R=(C=L.getTransformedOptions(S,C,B)).left||0,x=C.top||0,C.sourceWidth?(f=C.sourceWidth,C.right!==void 0&&C.left===void 0&&(R=w-f-C.right)):f=w-R-(C.right||0),C.sourceHeight?(k=C.sourceHeight,C.bottom!==void 0&&C.top===void 0&&(x=I-k-C.bottom)):k=I-x-(C.bottom||0),T=f,M=k),O=C.maxWidth,A=C.maxHeight,d=C.minWidth,P=C.minHeight,b&&O&&A&&C.crop?(T=O,M=A,(u=f/k-O/A)<0?(k=A*f/O,C.top===void 0&&C.bottom===void 0&&(x=(I-k)/2)):u>0&&(f=O*k/A,C.left===void 0&&C.right===void 0&&(R=(w-f)/2))):((C.contain||C.cover)&&(d=O=O||d,P=A=A||P),C.cover?(Q(),z()):(z(),Q())),b){if((m=C.pixelRatio)>1&&(!S.style.width||Math.floor(parseFloat(S.style.width,10))!==Math.floor(w/m))&&(T*=m,M*=m),L.orientationCropBug&&!S.getContext&&(R||x||f!==w||k!==I)&&(u=S,S=L.createCanvas(w,I,!0),L.drawImage(u,S,0,0,w,I,w,I,C)),(p=C.downsamplingRatio)>0&&p<1&&T<f&&M<k)for(;f*p>T;)_=L.createCanvas(f*p,k*p,!0),L.drawImage(S,_,R,x,f,k,_.width,_.height,C),R=0,x=0,f=_.width,k=_.height,S=_;return _=L.createCanvas(T,M),L.transformCoordinates(_,C,B),m>1&&(_.style.width=_.width/m+"px"),L.drawImage(S,_,R,x,f,k,T,M,C).setTransform(1,0,0,1,0,0),_}return S.width=T,S.height=M,S}})=="function"?j.apply(Y,G):j)===void 0||(V.exports=K)})()},302:function(V,Y,q){var j;(function(G){var K=G.URL||G.webkitURL;function re(O){return!!K&&K.createObjectURL(O)}function L(O){return!!K&&K.revokeObjectURL(O)}function N(O,A){!O||O.slice(0,5)!=="blob:"||A&&A.noRevoke||L(O)}function S(O,A,d,P){if(!G.FileReader)return!1;var f=new FileReader;f.onload=function(){A.call(f,this.result)},d&&(f.onabort=f.onerror=function(){d.call(f,this.error)});var k=f[P||"readAsDataURL"];return k?(k.call(f,O),f):void 0}function C(O,A){return Object.prototype.toString.call(A)==="[object "+O+"]"}function B(O,A,d){function P(f,k){var R,x=document.createElement("img");function m(u,_){f!==k?u instanceof Error?k(u):((_=_||{}).image=u,f(_)):f&&f(u,_)}function p(u,_){_&&G.console&&console.log(_),u&&C("Blob",u)?R=re(O=u):(R=O,d&&d.crossOrigin&&(x.crossOrigin=d.crossOrigin)),x.src=R}return x.onerror=function(u){N(R,d),k&&k.call(x,u)},x.onload=function(){N(R,d);var u={originalWidth:x.naturalWidth||x.width,originalHeight:x.naturalHeight||x.height};try{B.transform(x,d,m,O,u)}catch(_){k&&k(_)}},typeof O=="string"?(B.requiresMetaData(d)?B.fetchBlob(O,p,d):p(),x):C("Blob",O)||C("File",O)?(R=re(O))?(x.src=R,x):S(O,function(u){x.src=u},k):void 0}return G.Promise&&typeof A!="function"?(d=A,new Promise(P)):P(A,A)}B.requiresMetaData=function(O){return O&&O.meta},B.fetchBlob=function(O,A){A()},B.transform=function(O,A,d,P,f){d(O,f)},B.global=G,B.readFile=S,B.isInstanceOf=C,B.createObjectURL=re,B.revokeObjectURL=L,(j=(function(){return B}).call(Y,q,Y,V))===void 0||(V.exports=j)})(typeof window<"u"&&window||this)},918:function(V,Y){var q;(function(){var j=function(m){return m instanceof j?m:this instanceof j?void(this.EXIFwrapped=m):new j(m)};V.exports&&(Y=V.exports=j),Y.EXIF=j;var G=j.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},K=j.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},re=j.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},L=j.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},N=j.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function S(m){return!!m.exifdata}function C(m,p){function u(w){var I=B(w);m.exifdata=I||{};var T=function(z){var Q=new DataView(z);if(Q.getUint8(0)!=255||Q.getUint8(1)!=216)return!1;for(var J=2,H=z.byteLength,ie=function(he,le){return he.getUint8(le)===56&&he.getUint8(le+1)===66&&he.getUint8(le+2)===73&&he.getUint8(le+3)===77&&he.getUint8(le+4)===4&&he.getUint8(le+5)===4};J<H;){if(ie(Q,J)){var ne=Q.getUint8(J+7);return ne%2!=0&&(ne+=1),ne===0&&(ne=4),A(z,J+8+ne,Q.getUint16(J+6+ne))}J++}}(w);if(m.iptcdata=T||{},j.isXmpEnabled){var M=function(z){if("DOMParser"in self){var Q=new DataView(z);if(Q.getUint8(0)!=255||Q.getUint8(1)!=216)return!1;for(var J=2,H=z.byteLength,ie=new DOMParser;J<H-4;){if(f(Q,J,4)=="http"){var ne=J-1,he=Q.getUint16(J-2)-1,le=f(Q,ne,he),xe=le.indexOf("xmpmeta>")+8,Ee=(le=le.substring(le.indexOf("<x:xmpmeta"),xe)).indexOf("x:xmpmeta")+10;return le=le.slice(0,Ee)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+le.slice(Ee),x(ie.parseFromString(le,"text/xml"))}J++}}}(w);m.xmpdata=M||{}}p&&p.call(m)}if(m.src)if(/^data\:/i.test(m.src))u(function(w,I){I=I||w.match(/^data\:([^\;]+)\;base64,/im)[1]||"",w=w.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var T=atob(w),M=T.length,z=new ArrayBuffer(M),Q=new Uint8Array(z),J=0;J<M;J++)Q[J]=T.charCodeAt(J);return z}(m.src));else if(/^blob\:/i.test(m.src))(b=new FileReader).onload=function(w){u(w.target.result)},function(w,I){var T=new XMLHttpRequest;T.open("GET",w,!0),T.responseType="blob",T.onload=function(M){var z;this.status!=200&&this.status!==0||(z=this.response,b.readAsArrayBuffer(z))},T.send()}(m.src);else{var _=new XMLHttpRequest;_.onload=function(){if(this.status!=200&&this.status!==0)throw"Could not load image";u(_.response),_=null},_.open("GET",m.src,!0),_.responseType="arraybuffer",_.send(null)}else if(self.FileReader&&(m instanceof self.Blob||m instanceof self.File)){var b;(b=new FileReader).onload=function(w){u(w.target.result)},b.readAsArrayBuffer(m)}}function B(m){var p=new DataView(m);if(p.getUint8(0)!=255||p.getUint8(1)!=216)return!1;for(var u=2,_=m.byteLength;u<_;){if(p.getUint8(u)!=255)return!1;if(p.getUint8(u+1)==225)return k(p,u+4,p.getUint16(u+2));u+=2+p.getUint16(u+2)}}var O={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function A(m,p,u){for(var _,b,w,I,T=new DataView(m),M={},z=p;z<p+u;)T.getUint8(z)===28&&T.getUint8(z+1)===2&&(I=T.getUint8(z+2))in O&&(w=T.getInt16(z+3),b=O[I],_=f(T,z+5,w),M.hasOwnProperty(b)?M[b]instanceof Array?M[b].push(_):M[b]=[M[b],_]:M[b]=_),z++;return M}function d(m,p,u,_,b){var w,I,T=m.getUint16(u,!b),M={};for(I=0;I<T;I++)w=u+12*I+2,M[_[m.getUint16(w,!b)]]=P(m,w,p,0,b);return M}function P(m,p,u,_,b){var w,I,T,M,z,Q,J=m.getUint16(p+2,!b),H=m.getUint32(p+4,!b),ie=m.getUint32(p+8,!b)+u;switch(J){case 1:case 7:if(H==1)return m.getUint8(p+8,!b);for(w=H>4?ie:p+8,I=[],M=0;M<H;M++)I[M]=m.getUint8(w+M);return I;case 2:return f(m,w=H>4?ie:p+8,H-1);case 3:if(H==1)return m.getUint16(p+8,!b);for(w=H>2?ie:p+8,I=[],M=0;M<H;M++)I[M]=m.getUint16(w+2*M,!b);return I;case 4:if(H==1)return m.getUint32(p+8,!b);for(I=[],M=0;M<H;M++)I[M]=m.getUint32(ie+4*M,!b);return I;case 5:if(H==1)return z=m.getUint32(ie,!b),Q=m.getUint32(ie+4,!b),(T=new Number(z/Q)).numerator=z,T.denominator=Q,T;for(I=[],M=0;M<H;M++)z=m.getUint32(ie+8*M,!b),Q=m.getUint32(ie+4+8*M,!b),I[M]=new Number(z/Q),I[M].numerator=z,I[M].denominator=Q;return I;case 9:if(H==1)return m.getInt32(p+8,!b);for(I=[],M=0;M<H;M++)I[M]=m.getInt32(ie+4*M,!b);return I;case 10:if(H==1)return m.getInt32(ie,!b)/m.getInt32(ie+4,!b);for(I=[],M=0;M<H;M++)I[M]=m.getInt32(ie+8*M,!b)/m.getInt32(ie+4+8*M,!b);return I}}function f(m,p,u){var _="";for(n=p;n<p+u;n++)_+=String.fromCharCode(m.getUint8(n));return _}function k(m,p){if(f(m,p,4)!="Exif")return!1;var u,_,b,w,I,T=p+6;if(m.getUint16(T)==18761)u=!1;else{if(m.getUint16(T)!=19789)return!1;u=!0}if(m.getUint16(T+2,!u)!=42)return!1;var M=m.getUint32(T+4,!u);if(M<8)return!1;if((_=d(m,T,T+M,K,u)).ExifIFDPointer)for(b in w=d(m,T,T+_.ExifIFDPointer,G,u)){switch(b){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":w[b]=N[b][w[b]];break;case"ExifVersion":case"FlashpixVersion":w[b]=String.fromCharCode(w[b][0],w[b][1],w[b][2],w[b][3]);break;case"ComponentsConfiguration":w[b]=N.Components[w[b][0]]+N.Components[w[b][1]]+N.Components[w[b][2]]+N.Components[w[b][3]]}_[b]=w[b]}if(_.GPSInfoIFDPointer)for(b in I=d(m,T,T+_.GPSInfoIFDPointer,re,u)){switch(b){case"GPSVersionID":I[b]=I[b][0]+"."+I[b][1]+"."+I[b][2]+"."+I[b][3]}_[b]=I[b]}return _.thumbnail=function(z,Q,J,H){var ie=function(xe,Ee,Ue){var Je=xe.getUint16(Ee,!Ue);return xe.getUint32(Ee+2+12*Je,!Ue)}(z,Q+J,H);if(!ie)return{};if(ie>z.byteLength)return{};var ne=d(z,Q,Q+ie,L,H);if(ne.Compression)switch(ne.Compression){case 6:if(ne.JpegIFOffset&&ne.JpegIFByteCount){var he=Q+ne.JpegIFOffset,le=ne.JpegIFByteCount;ne.blob=new Blob([new Uint8Array(z.buffer,he,le)],{type:"image/jpeg"})}break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",ne.Compression)}else ne.PhotometricInterpretation==2&&console.log("Thumbnail image format is RGB, which is not implemented.");return ne}(m,T,M,u),_}function R(m){var p={};if(m.nodeType==1){if(m.attributes.length>0){p["@attributes"]={};for(var u=0;u<m.attributes.length;u++){var _=m.attributes.item(u);p["@attributes"][_.nodeName]=_.nodeValue}}}else if(m.nodeType==3)return m.nodeValue;if(m.hasChildNodes())for(var b=0;b<m.childNodes.length;b++){var w=m.childNodes.item(b),I=w.nodeName;if(p[I]==null)p[I]=R(w);else{if(p[I].push==null){var T=p[I];p[I]=[],p[I].push(T)}p[I].push(R(w))}}return p}function x(m){try{var p={};if(m.children.length>0)for(var u=0;u<m.children.length;u++){var _=m.children.item(u),b=_.attributes;for(var w in b){var I=b[w],T=I.nodeName,M=I.nodeValue;T!==void 0&&(p[T]=M)}var z=_.nodeName;if(p[z]===void 0)p[z]=R(_);else{if(p[z].push===void 0){var Q=p[z];p[z]=[],p[z].push(Q)}p[z].push(R(_))}}else p=m.textContent;return p}catch(J){console.log(J.message)}}j.enableXmp=function(){j.isXmpEnabled=!0},j.disableXmp=function(){j.isXmpEnabled=!1},j.getData=function(m,p){return!((self.Image&&m instanceof self.Image||self.HTMLImageElement&&m instanceof self.HTMLImageElement)&&!m.complete||(S(m)?p&&p.call(m):C(m,p),0))},j.getTag=function(m,p){if(S(m))return m.exifdata[p]},j.getIptcTag=function(m,p){if(S(m))return m.iptcdata[p]},j.getAllTags=function(m){if(!S(m))return{};var p,u=m.exifdata,_={};for(p in u)u.hasOwnProperty(p)&&(_[p]=u[p]);return _},j.getAllIptcTags=function(m){if(!S(m))return{};var p,u=m.iptcdata,_={};for(p in u)u.hasOwnProperty(p)&&(_[p]=u[p]);return _},j.pretty=function(m){if(!S(m))return"";var p,u=m.exifdata,_="";for(p in u)u.hasOwnProperty(p)&&(typeof u[p]=="object"?u[p]instanceof Number?_+=p+" : "+u[p]+" ["+u[p].numerator+"/"+u[p].denominator+`]\r
`:_+=p+" : ["+u[p].length+` values]\r
`:_+=p+" : "+u[p]+`\r
`);return _},j.readFromBinaryFile=function(m){return B(m)},(q=(function(){return j}).apply(Y,[]))===void 0||(V.exports=q)}).call(this)},297:V=>{V.exports=Se}},ke={};function ue(V){if(ke[V])return ke[V].exports;var Y=ke[V]={exports:{}};return we[V].call(Y.exports,Y,Y.exports,ue),Y.exports}ue.n=V=>{var Y=V&&V.__esModule?()=>V.default:()=>V;return ue.d(Y,{a:Y}),Y},ue.d=(V,Y)=>{for(var q in Y)ue.o(Y,q)&&!ue.o(V,q)&&Object.defineProperty(V,q,{enumerable:!0,get:Y[q]})},ue.o=(V,Y)=>Object.prototype.hasOwnProperty.call(V,Y),ue.r=V=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(V,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(V,"__esModule",{value:!0})};var Be={};return(()=>{ue.r(Be),ue.d(Be,{default:()=>bi});var V=ue(297),Y=ue.n(V),q=Math.PI/180;const j=typeof Zt<"u"?Zt:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},G={_global:j,version:"8.3.5",isBrowser:typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]"),isUnminified:/param/.test((function(a){}).toString()),dblClickWindow:400,getAngle:a=>G.angleDeg?a*q:a,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>G.DD.isDragging,isDragReady:()=>!!G.DD.node,document:j.document,_injectGlobal(a){j.Konva=a}},K=a=>{G[a.prototype.getClassName()]=a};G._injectGlobal(G);class re{constructor(e=[1,0,0,1,0,0]){this.dirty=!1,this.m=e&&e.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new re(this.m)}copyInto(e){e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5]}point(e){var t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}}translate(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this}scale(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this}rotate(e){var t=Math.cos(e),i=Math.sin(e),r=this.m[0]*t+this.m[2]*i,o=this.m[1]*t+this.m[3]*i,s=this.m[0]*-i+this.m[2]*t,h=this.m[1]*-i+this.m[3]*t;return this.m[0]=r,this.m[1]=o,this.m[2]=s,this.m[3]=h,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(e,t){var i=this.m[0]+this.m[2]*t,r=this.m[1]+this.m[3]*t,o=this.m[2]+this.m[0]*e,s=this.m[3]+this.m[1]*e;return this.m[0]=i,this.m[1]=r,this.m[2]=o,this.m[3]=s,this}multiply(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],i=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],o=this.m[1]*e.m[2]+this.m[3]*e.m[3],s=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],h=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=i,this.m[2]=r,this.m[3]=o,this.m[4]=s,this.m[5]=h,this}invert(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,i=-this.m[1]*e,r=-this.m[2]*e,o=this.m[0]*e,s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),h=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=i,this.m[2]=r,this.m[3]=o,this.m[4]=s,this.m[5]=h,this}getMatrix(){return this.m}setAbsolutePosition(e,t){var i=this.m[0],r=this.m[1],o=this.m[2],s=this.m[3],h=this.m[4],l=(i*(t-this.m[5])-r*(e-h))/(i*s-r*o),c=(e-h-o*l)/i;return this.translate(c,l)}decompose(){var e=this.m[0],t=this.m[1],i=this.m[2],r=this.m[3],o=e*r-t*i;let s={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(e!=0||t!=0){var h=Math.sqrt(e*e+t*t);s.rotation=t>0?Math.acos(e/h):-Math.acos(e/h),s.scaleX=h,s.scaleY=o/h,s.skewX=(e*i+t*r)/o,s.skewY=0}else if(i!=0||r!=0){var l=Math.sqrt(i*i+r*r);s.rotation=Math.PI/2-(r>0?Math.acos(-i/l):-Math.acos(i/l)),s.scaleX=o/l,s.scaleY=l,s.skewX=0,s.skewY=(e*i+t*r)/o}return s.rotation=d._getRotation(s.rotation),s}}var L=Math.PI/180,N=180/Math.PI,S="Konva error: ",C={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},B=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,O=[];const A=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(a){setTimeout(a,60)},d={_isElement:a=>!(!a||a.nodeType!=1),_isFunction:a=>!!(a&&a.constructor&&a.call&&a.apply),_isPlainObject:a=>!!a&&a.constructor===Object,_isArray:a=>Object.prototype.toString.call(a)==="[object Array]",_isNumber:a=>Object.prototype.toString.call(a)==="[object Number]"&&!isNaN(a)&&isFinite(a),_isString:a=>Object.prototype.toString.call(a)==="[object String]",_isBoolean:a=>Object.prototype.toString.call(a)==="[object Boolean]",isObject:a=>a instanceof Object,isValidSelector(a){if(typeof a!="string")return!1;var e=a[0];return e==="#"||e==="."||e===e.toUpperCase()},_sign:a=>a===0||a>0?1:-1,requestAnimFrame(a){O.push(a),O.length===1&&A(function(){const e=O;O=[],e.forEach(function(t){t()})})},createCanvasElement(){var a=document.createElement("canvas");try{a.style=a.style||{}}catch{}return a},createImageElement:()=>document.createElement("img"),_isInDocument(a){for(;a=a.parentNode;)if(a==document)return!0;return!1},_urlToImage(a,e){var t=d.createImageElement();t.onload=function(){e(t)},t.src=a},_rgbToHex:(a,e,t)=>((1<<24)+(a<<16)+(e<<8)+t).toString(16).slice(1),_hexToRgb(a){a=a.replace("#","");var e=parseInt(a,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor(){for(var a=(16777215*Math.random()<<0).toString(16);a.length<6;)a="0"+a;return"#"+a},getRGB(a){var e;return a in C?{r:(e=C[a])[0],g:e[1],b:e[2]}:a[0]==="#"?this._hexToRgb(a.substring(1)):a.substr(0,4)==="rgb("?(e=B.exec(a.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:a=>(a=a||"black",d._namedColorToRBA(a)||d._hex3ColorToRGBA(a)||d._hex6ColorToRGBA(a)||d._rgbColorToRGBA(a)||d._rgbaColorToRGBA(a)||d._hslColorToRGBA(a)),_namedColorToRBA(a){var e=C[a.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(a){if(a.indexOf("rgb(")===0){var e=(a=a.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(a){if(a.indexOf("rgba(")===0){var e=(a=a.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map((t,i)=>t.slice(-1)==="%"?i===3?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex6ColorToRGBA(a){if(a[0]==="#"&&a.length===7)return{r:parseInt(a.slice(1,3),16),g:parseInt(a.slice(3,5),16),b:parseInt(a.slice(5,7),16),a:1}},_hex3ColorToRGBA(a){if(a[0]==="#"&&a.length===4)return{r:parseInt(a[1]+a[1],16),g:parseInt(a[2]+a[2],16),b:parseInt(a[3]+a[3],16),a:1}},_hslColorToRGBA(a){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(a)){const[e,...t]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(a),i=Number(t[0])/360,r=Number(t[1])/100,o=Number(t[2])/100;let s,h,l;if(r===0)return l=255*o,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};s=o<.5?o*(1+r):o+r-o*r;const c=2*o-s,g=[0,0,0];for(let v=0;v<3;v++)h=i+1/3*-(v-1),h<0&&h++,h>1&&h--,l=6*h<1?c+6*(s-c)*h:2*h<1?s:3*h<2?c+(s-c)*(2/3-h)*6:c,g[v]=255*l;return{r:Math.round(g[0]),g:Math.round(g[1]),b:Math.round(g[2]),a:1}}},haveIntersection:(a,e)=>!(e.x>a.x+a.width||e.x+e.width<a.x||e.y>a.y+a.height||e.y+e.height<a.y),cloneObject(a){var e={};for(var t in a)this._isPlainObject(a[t])?e[t]=this.cloneObject(a[t]):this._isArray(a[t])?e[t]=this.cloneArray(a[t]):e[t]=a[t];return e},cloneArray:a=>a.slice(0),degToRad:a=>a*L,radToDeg:a=>a*N,_degToRad:a=>(d.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),d.degToRad(a)),_radToDeg:a=>(d.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),d.radToDeg(a)),_getRotation:a=>G.angleDeg?d.radToDeg(a):a,_capitalize:a=>a.charAt(0).toUpperCase()+a.slice(1),throw(a){throw new Error(S+a)},error(a){console.error(S+a)},warn(a){G.showWarnings&&console.warn("Konva warning: "+a)},each(a,e){for(var t in a)e(t,a[t])},_inRange:(a,e,t)=>e<=a&&a<t,_getProjectionToSegment(a,e,t,i,r,o){var s,h,l,c=(a-t)*(a-t)+(e-i)*(e-i);if(c==0)s=a,h=e,l=(r-t)*(r-t)+(o-i)*(o-i);else{var g=((r-a)*(t-a)+(o-e)*(i-e))/c;g<0?(s=a,h=e,l=(a-r)*(a-r)+(e-o)*(e-o)):g>1?(s=t,h=i,l=(t-r)*(t-r)+(i-o)*(i-o)):l=((s=a+g*(t-a))-r)*(s-r)+((h=e+g*(i-e))-o)*(h-o)}return[s,h,l]},_getProjectionToLine(a,e,t){var i=d.cloneObject(a),r=Number.MAX_VALUE;return e.forEach(function(o,s){if(t||s!==e.length-1){var h=e[(s+1)%e.length],l=d._getProjectionToSegment(o.x,o.y,h.x,h.y,a.x,a.y),c=l[0],g=l[1],v=l[2];v<r&&(i.x=c,i.y=g,r=v)}}),i},_prepareArrayForTween(a,e,t){var i,r=[],o=[];if(a.length>e.length){var s=e;e=a,a=s}for(i=0;i<a.length;i+=2)r.push({x:a[i],y:a[i+1]});for(i=0;i<e.length;i+=2)o.push({x:e[i],y:e[i+1]});var h=[];return o.forEach(function(l){var c=d._getProjectionToLine(l,r,t);h.push(c.x),h.push(c.y)}),h},_prepareToStringify(a){var e;for(var t in a.visitedByCircularReferenceRemoval=!0,a)if(a.hasOwnProperty(t)&&a[t]&&typeof a[t]=="object"){if(e=Object.getOwnPropertyDescriptor(a,t),a[t].visitedByCircularReferenceRemoval||d._isElement(a[t])){if(!e.configurable)return null;delete a[t]}else if(d._prepareToStringify(a[t])===null){if(!e.configurable)return null;delete a[t]}}return delete a.visitedByCircularReferenceRemoval,a},_assign(a,e){for(var t in e)a[t]=e[t];return a},_getFirstPointerId:a=>a.touches?a.changedTouches[0].identifier:a.pointerId||999};function P(a){return d._isString(a)?'"'+a+'"':Object.prototype.toString.call(a)==="[object Number]"||d._isBoolean(a)?a:Object.prototype.toString.call(a)}function f(){if(G.isUnminified)return function(a,e){return d._isNumber(a)||d.warn(P(a)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),a}}function k(){if(G.isUnminified)return function(a,e){return d._isString(a)||d.warn(P(a)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),a}}function R(){if(G.isUnminified)return function(a,e){const t=d._isString(a),i=Object.prototype.toString.call(a)==="[object CanvasGradient]"||a&&a.addColorStop;return t||i||d.warn(P(a)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),a}}function x(){if(G.isUnminified)return function(a,e){return a===!0||a===!1||d.warn(P(a)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),a}}var m="get",p="set";const u={addGetterSetter(a,e,t,i,r){u.addGetter(a,e,t),u.addSetter(a,e,i,r),u.addOverloadedGetterSetter(a,e)},addGetter(a,e,t){var i=m+d._capitalize(e);a.prototype[i]=a.prototype[i]||function(){var r=this.attrs[e];return r===void 0?t:r}},addSetter(a,e,t,i){var r=p+d._capitalize(e);a.prototype[r]||u.overWriteSetter(a,e,t,i)},overWriteSetter(a,e,t,i){var r=p+d._capitalize(e);a.prototype[r]=function(o){return t&&o!=null&&(o=t.call(this,o,e)),this._setAttr(e,o),i&&i.call(this),this}},addComponentsGetterSetter(a,e,t,i,r){var o,s,h=t.length,l=d._capitalize,c=m+l(e),g=p+l(e);a.prototype[c]=function(){var E={};for(o=0;o<h;o++)E[s=t[o]]=this.getAttr(e+l(s));return E};var v=function(E){if(G.isUnminified)return function(D,y){return d.isObject(D)||d.warn(P(D)+' is a not valid value for "'+y+'" attribute. The value should be an object with properties '+E),D}}(t);a.prototype[g]=function(E){var D,y=this.attrs[e];for(D in i&&(E=i.call(this,E)),v&&v.call(this,E,e),E)E.hasOwnProperty(D)&&this._setAttr(e+l(D),E[D]);return this._fireChangeEvent(e,y,E),r&&r.call(this),this},u.addOverloadedGetterSetter(a,e)},addOverloadedGetterSetter(a,e){var t=d._capitalize(e),i=p+t,r=m+t;a.prototype[e]=function(){return arguments.length?(this[i](arguments[0]),this):this[r]()}},addDeprecatedGetterSetter(a,e,t,i){d.error("Adding deprecated "+e);var r=m+d._capitalize(e),o=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[r]=function(){d.error(o);var s=this.attrs[e];return s===void 0?t:s},u.addSetter(a,e,i,function(){d.error(o)}),u.addOverloadedGetterSetter(a,e)},backCompat(a,e){d.each(e,function(t,i){var r=a.prototype[i],o=m+d._capitalize(t),s=p+d._capitalize(t);function h(){r.apply(this,arguments),d.error('"'+t+'" method is deprecated and will be removed soon. Use ""'+i+'" instead.')}a.prototype[t]=h,a.prototype[o]=h,a.prototype[s]=h})},afterSetFilter(){this._filterUpToDate=!1}};function _(a){var e,t,i=[],r=a.length,o=d;for(e=0;e<r;e++)t=a[e],o._isNumber(t)?t=Math.round(1e3*t)/1e3:o._isString(t)||(t+=""),i.push(t);return i}var b,w=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];class I{constructor(e){this.canvas=e,this._context=e._canvas.getContext("2d"),G.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,t){var i,r,o,s,h=this.traceArr,l=h.length,c="";for(i=0;i<l;i++)(o=(r=h[i]).method)?(s=r.args,c+=o,e?c+="()":d._isArray(s[0])?c+="(["+s.join(",")+"])":(t&&(s=s.map(g=>typeof g=="number"?Math.floor(g):g)),c+="("+s.join(",")+")")):(c+=r.property,e||(c+="="+r.val)),c+=";";return c}clearTrace(){this.traceArr=[]}_trace(e){var t=this.traceArr;t.push(e),t.length>=100&&t.shift()}reset(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){var t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}_applyLineCap(e){var t=e.getLineCap();t&&this.setAttr("lineCap",t)}_applyOpacity(e){var t=e.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)}_applyLineJoin(e){var t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}setAttr(e,t){this._context[e]=t}arc(e,t,i,r,o,s){this._context.arc(e,t,i,r,o,s)}arcTo(e,t,i,r,o){this._context.arcTo(e,t,i,r,o)}beginPath(){this._context.beginPath()}bezierCurveTo(e,t,i,r,o,s){this._context.bezierCurveTo(e,t,i,r,o,s)}clearRect(e,t,i,r){this._context.clearRect(e,t,i,r)}clip(){this._context.clip()}closePath(){this._context.closePath()}createImageData(e,t){var i=arguments;return i.length===2?this._context.createImageData(e,t):i.length===1?this._context.createImageData(e):void 0}createLinearGradient(e,t,i,r){return this._context.createLinearGradient(e,t,i,r)}createPattern(e,t){return this._context.createPattern(e,t)}createRadialGradient(e,t,i,r,o,s){return this._context.createRadialGradient(e,t,i,r,o,s)}drawImage(e,t,i,r,o,s,h,l,c){var g=arguments,v=this._context;g.length===3?v.drawImage(e,t,i):g.length===5?v.drawImage(e,t,i,r,o):g.length===9&&v.drawImage(e,t,i,r,o,s,h,l,c)}ellipse(e,t,i,r,o,s,h,l){this._context.ellipse(e,t,i,r,o,s,h,l)}isPointInPath(e,t){return this._context.isPointInPath(e,t)}fill(e){e?this._context.fill(e):this._context.fill()}fillRect(e,t,i,r){this._context.fillRect(e,t,i,r)}strokeRect(e,t,i,r){this._context.strokeRect(e,t,i,r)}fillText(e,t,i,r){r?this._context.fillText(e,t,i,r):this._context.fillText(e,t,i)}measureText(e){return this._context.measureText(e)}getImageData(e,t,i,r){return this._context.getImageData(e,t,i,r)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}rect(e,t,i,r){this._context.rect(e,t,i,r)}putImageData(e,t,i){this._context.putImageData(e,t,i)}quadraticCurveTo(e,t,i,r){this._context.quadraticCurveTo(e,t,i,r)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,t){this._context.scale(e,t)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,t,i,r,o,s){this._context.setTransform(e,t,i,r,o,s)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,t,i,r){this._context.strokeText(e,t,i,r)}transform(e,t,i,r,o,s){this._context.transform(e,t,i,r,o,s)}translate(e,t){this._context.translate(e,t)}_enableTrace(){var e,t,i=this,r=w.length,o=this.setAttr,s=function(h){var l,c=i[h];i[h]=function(){return t=_(Array.prototype.slice.call(arguments,0)),l=c.apply(i,arguments),i._trace({method:h,args:t}),l}};for(e=0;e<r;e++)s(w[e]);i.setAttr=function(){o.apply(i,arguments);var h=arguments[0],l=arguments[1];h!=="shadowOffsetX"&&h!=="shadowOffsetY"&&h!=="shadowBlur"||(l/=this.canvas.getPixelRatio()),i._trace({property:h,val:l})}}_applyGlobalCompositeOperation(e){const t=e.attrs.globalCompositeOperation;!t||t==="source-over"||this.setAttr("globalCompositeOperation",t)}}["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"].forEach(function(a){Object.defineProperty(I.prototype,a,{get(){return this._context[a]},set(e){this._context[a]=e}})});class T extends I{_fillColor(e){var t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){var t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fillRadialGradient(e){var t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fill(e){var t=e.fill(),i=e.getFillPriority();if(t&&i==="color")this._fillColor(e);else{var r=e.getFillPatternImage();if(r&&i==="pattern")this._fillPattern(e);else{var o=e.getFillLinearGradientColorStops();if(o&&i==="linear-gradient")this._fillLinearGradient(e);else{var s=e.getFillRadialGradientColorStops();s&&i==="radial-gradient"?this._fillRadialGradient(e):t?this._fillColor(e):r?this._fillPattern(e):o?this._fillLinearGradient(e):s&&this._fillRadialGradient(e)}}}}_strokeLinearGradient(e){var t=e.getStrokeLinearGradientStartPoint(),i=e.getStrokeLinearGradientEndPoint(),r=e.getStrokeLinearGradientColorStops(),o=this.createLinearGradient(t.x,t.y,i.x,i.y);if(r){for(var s=0;s<r.length;s+=2)o.addColorStop(r[s],r[s+1]);this.setAttr("strokeStyle",o)}}_stroke(e){var t=e.dash(),i=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!i){this.save();var r=this.getCanvas().getPixelRatio();this.setTransform(r,0,0,r,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),i||this.restore()}}_applyShadow(e){var t,i,r,o=(t=e.getShadowRGBA())!==null&&t!==void 0?t:"black",s=(i=e.getShadowBlur())!==null&&i!==void 0?i:5,h=(r=e.getShadowOffset())!==null&&r!==void 0?r:{x:0,y:0},l=e.getAbsoluteScale(),c=this.canvas.getPixelRatio(),g=l.x*c,v=l.y*c;this.setAttr("shadowColor",o),this.setAttr("shadowBlur",s*Math.min(Math.abs(g),Math.abs(v))),this.setAttr("shadowOffsetX",h.x*g),this.setAttr("shadowOffsetY",h.y*v)}}class M extends I{_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){var t=e.getStrokeScaleEnabled();if(!t){this.save();var i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(e);var r=e.hitStrokeWidth(),o=r==="auto"?e.strokeWidth():r;this.setAttr("lineWidth",o),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),t||this.restore()}}}class z{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var t=(e||{}).pixelRatio||G.pixelRatio||function(){if(b)return b;var i=d.createCanvasElement().getContext("2d");return b=(G._global.devicePixelRatio||1)/(i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1)}();this.pixelRatio=t,this._canvas=d.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){var t=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/t,this.getHeight()/t)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";var t=this.pixelRatio;this.getContext()._context.scale(t,t)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";var t=this.pixelRatio;this.getContext()._context.scale(t,t)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,t){this.setWidth(e||0),this.setHeight(t||0)}toDataURL(e,t){try{return this._canvas.toDataURL(e,t)}catch{try{return this._canvas.toDataURL()}catch(r){return d.error("Unable to get data URL. "+r.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}u.addGetterSetter(z,"pixelRatio",void 0,f());class Q extends z{constructor(e={width:0,height:0}){super(e),this.context=new T(this),this.setSize(e.width,e.height)}}class J extends z{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new M(this),this.setSize(e.width,e.height)}}const H={get isDragging(){var a=!1;return H._dragElements.forEach(e=>{e.dragStatus==="dragging"&&(a=!0)}),a},justDragged:!1,get node(){var a;return H._dragElements.forEach(e=>{a=e.node}),a},_dragElements:new Map,_drag(a){const e=[];H._dragElements.forEach((t,i)=>{const{node:r}=t,o=r.getStage();o.setPointersPositions(a),t.pointerId===void 0&&(t.pointerId=d._getFirstPointerId(a));const s=o._changedPointerPositions.find(l=>l.id===t.pointerId);if(s){if(t.dragStatus!=="dragging"){var h=r.dragDistance();if(Math.max(Math.abs(s.x-t.startPointerPos.x),Math.abs(s.y-t.startPointerPos.y))<h||(r.startDrag({evt:a}),!r.isDragging()))return}r._setDragPosition(a,t),e.push(r)}}),e.forEach(t=>{t.fire("dragmove",{type:"dragmove",target:t,evt:a},!0)})},_endDragBefore(a){H._dragElements.forEach(e=>{const{node:t}=e,i=t.getStage();if(a&&i.setPointersPositions(a),!i._changedPointerPositions.find(o=>o.id===e.pointerId))return;e.dragStatus!=="dragging"&&e.dragStatus!=="stopped"||(H.justDragged=!0,G._mouseListenClick=!1,G._touchListenClick=!1,G._pointerListenClick=!1,e.dragStatus="stopped");const r=e.node.getLayer()||e.node instanceof G.Stage&&e.node;r&&r.batchDraw()})},_endDragAfter(a){H._dragElements.forEach((e,t)=>{e.dragStatus==="stopped"&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:a},!0),e.dragStatus!=="dragging"&&H._dragElements.delete(t)})}};G.isBrowser&&(window.addEventListener("mouseup",H._endDragBefore,!0),window.addEventListener("touchend",H._endDragBefore,!0),window.addEventListener("mousemove",H._drag),window.addEventListener("touchmove",H._drag),window.addEventListener("mouseup",H._endDragAfter,!1),window.addEventListener("touchend",H._endDragAfter,!1));var ie="absoluteOpacity",ne="allEventListeners",he="absoluteTransform",le="absoluteScale",xe="canvas",Ee="listening",Ue="mouseenter",Je="mouseleave",St="Shape",Ze=" ",wt="stage",De="transform",ht="visible",oi=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Ze);let hi=1;class W{constructor(e){this._id=hi++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){e!==De&&e!==he||!this._cache.get(e)?e?this._cache.delete(e):this._cache.clear():this._cache.get(e).dirty=!0}_getCache(e,t){var i=this._cache.get(e);return(i===void 0||(e===De||e===he)&&i.dirty===!0)&&(i=t.call(this),this._cache.set(e,i)),i}_calculate(e,t,i){if(!this._attachedDepsListeners.get(e)){const r=t.map(o=>o+"Change.konva").join(Ze);this.on(r,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,i)}_getCanvasCache(){return this._cache.get(xe)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===he&&this.fire("absoluteTransformChange")}clearCache(){return this._cache.delete(xe),this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){var t=e||{},i={};t.x!==void 0&&t.y!==void 0&&t.width!==void 0&&t.height!==void 0||(i=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var r=Math.ceil(t.width||i.width),o=Math.ceil(t.height||i.height),s=t.pixelRatio,h=t.x===void 0?Math.floor(i.x):t.x,l=t.y===void 0?Math.floor(i.y):t.y,c=t.offset||0,g=t.drawBorder||!1,v=t.hitCanvasPixelRatio||1;if(r&&o){h-=c,l-=c;var E=new Q({pixelRatio:s,width:r+=2*c+1,height:o+=2*c+1}),D=new Q({pixelRatio:s,width:0,height:0}),y=new J({pixelRatio:v,width:r,height:o}),U=E.getContext(),ee=y.getContext();return y.isCache=!0,E.isCache=!0,this._cache.delete(xe),this._filterUpToDate=!1,t.imageSmoothingEnabled===!1&&(E.getContext()._context.imageSmoothingEnabled=!1,D.getContext()._context.imageSmoothingEnabled=!1),U.save(),ee.save(),U.translate(-h,-l),ee.translate(-h,-l),this._isUnderCache=!0,this._clearSelfAndDescendantCache(ie),this._clearSelfAndDescendantCache(le),this.drawScene(E,this),this.drawHit(y,this),this._isUnderCache=!1,U.restore(),ee.restore(),g&&(U.save(),U.beginPath(),U.rect(0,0,r,o),U.closePath(),U.setAttr("strokeStyle","red"),U.setAttr("lineWidth",5),U.stroke(),U.restore()),this._cache.set(xe,{scene:E,filter:D,hit:y,x:h,y:l}),this._requestDraw(),this}d.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")}isCached(){return this._cache.has(xe)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,t){var i,r,o,s,h=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}],l=this.getAbsoluteTransform(t);return h.forEach(function(c){var g=l.point(c);i===void 0&&(i=o=g.x,r=s=g.y),i=Math.min(i,g.x),r=Math.min(r,g.y),o=Math.max(o,g.x),s=Math.max(s,g.y)}),{x:i,y:r,width:o-i,height:s-r}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);const t=this._getCanvasCache();e.translate(t.x,t.y);var i=this._getCachedSceneCanvas(),r=i.pixelRatio;e.drawImage(i._canvas,0,0,i.width/r,i.height/r),e.restore()}_drawCachedHitCanvas(e){var t=this._getCanvasCache(),i=t.hit;e.save(),e.translate(t.x,t.y),e.drawImage(i._canvas,0,0,i.width/i.pixelRatio,i.height/i.pixelRatio),e.restore()}_getCachedSceneCanvas(){var e,t,i,r,o=this.filters(),s=this._getCanvasCache(),h=s.scene,l=s.filter,c=l.getContext();if(o){if(!this._filterUpToDate){var g=h.pixelRatio;l.setSize(h.width/h.pixelRatio,h.height/h.pixelRatio);try{for(e=o.length,c.clear(),c.drawImage(h._canvas,0,0,h.getWidth()/g,h.getHeight()/g),t=c.getImageData(0,0,l.getWidth(),l.getHeight()),i=0;i<e;i++)typeof(r=o[i])=="function"?(r.call(this,t),c.putImageData(t,0,0)):d.error("Filter should be type of function, but got "+typeof r+" instead. Please check correct filters")}catch(v){d.error("Unable to apply filter. "+v.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return l}return h}on(e,t){if(this._cache&&this._cache.delete(ne),arguments.length===3)return this._delegate.apply(this,arguments);var i,r,o,s,h=e.split(Ze),l=h.length;for(i=0;i<l;i++)o=(r=h[i].split("."))[0],s=r[1]||"",this.eventListeners[o]||(this.eventListeners[o]=[]),this.eventListeners[o].push({name:s,handler:t});return this}off(e,t){var i,r,o,s,h,l=(e||"").split(Ze),c=l.length;if(this._cache&&this._cache.delete(ne),!e)for(r in this.eventListeners)this._off(r);for(i=0;i<c;i++)if(s=(o=l[i].split("."))[0],h=o[1],s)this.eventListeners[s]&&this._off(s,h,t);else for(r in this.eventListeners)this._off(r,h,t);return this}dispatchEvent(e){var t={target:this,type:e.type,evt:e};return this.fire(e.type,t),this}addEventListener(e,t){return this.on(e,function(i){t.call(this,i.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,t,i){var r=this;this.on(e,function(o){for(var s=o.target.findAncestors(t,!0,r),h=0;h<s.length;h++)(o=d.cloneObject(o)).currentTarget=s[h],i.call(s[h],o)})}remove(){return this.isDragging()&&this.stopDrag(),H._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(he),this._clearSelfAndDescendantCache(ie),this._clearSelfAndDescendantCache(le),this._clearSelfAndDescendantCache(wt),this._clearSelfAndDescendantCache(ht),this._clearSelfAndDescendantCache(Ee)}_remove(){this._clearCaches();var e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this}getAttr(e){var t="get"+d._capitalize(e);return d._isFunction(this[t])?this[t]():this.attrs[e]}getAncestors(){for(var e=this.getParent(),t=[];e;)t.push(e),e=e.getParent();return t}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{var t,i;if(!e)return this;for(t in e)t!=="children"&&(i="set"+d._capitalize(t),d._isFunction(this[i])?this[i](e[t]):this._setAttr(t,e[t]))}),this}isListening(){return this._getCache(Ee,this._isListening)}_isListening(e){if(!this.listening())return!1;const t=this.getParent();return!t||t===e||this===e||t._isListening(e)}isVisible(){return this._getCache(ht,this._isVisible)}_isVisible(e){if(!this.visible())return!1;const t=this.getParent();return!t||t===e||this===e||t._isVisible(e)}shouldDrawHit(e,t=!1){if(e)return this._isVisible(e)&&this._isListening(e);var i=this.getLayer(),r=!1;H._dragElements.forEach(s=>{s.dragStatus==="dragging"&&(s.node.nodeType==="Stage"||s.node.getLayer()===i)&&(r=!0)});var o=!t&&!G.hitOnDragEnabled&&r;return this.isListening()&&this.isVisible()&&!o}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var e,t,i,r,o=this.getDepth(),s=this,h=0;return s.nodeType!=="Stage"&&function l(c){for(e=[],t=c.length,i=0;i<t;i++)r=c[i],h++,r.nodeType!==St&&(e=e.concat(r.getChildren().slice())),r._id===s._id&&(i=t);e.length>0&&e[0].getDepth()<=o&&l(e)}(s.getStage().getChildren()),h}getDepth(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(De),this._clearSelfAndDescendantCache(he)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){if(!this.getStage())return null;var e=this.getStage().getPointerPosition();if(!e)return null;var t=this.getAbsoluteTransform().copy();return t.invert(),t.point(e)}getAbsolutePosition(e){let t=!1,i=this.parent;for(;i;){if(i.isCached()){t=!0;break}i=i.parent}t&&!e&&(e=!0);var r=this.getAbsoluteTransform(e).getMatrix(),o=new re,s=this.offset();return o.m=r.slice(),o.translate(s.x,s.y),o.getTranslation()}setAbsolutePosition(e){var t=this._clearTransform();this.attrs.x=t.x,this.attrs.y=t.y,delete t.x,delete t.y,this._clearCache(De);var i=this._getAbsoluteTransform().copy();return i.invert(),i.translate(e.x,e.y),e={x:this.attrs.x+i.getTranslation().x,y:this.attrs.y+i.getTranslation().y},this._setTransform(t),this.setPosition({x:e.x,y:e.y}),this._clearCache(De),this._clearSelfAndDescendantCache(he),this}_setTransform(e){var t;for(t in e)this.attrs[t]=e[t]}_clearTransform(){var e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){var t=e.x,i=e.y,r=this.x(),o=this.y();return t!==void 0&&(r+=t),i!==void 0&&(o+=i),this.setPosition({x:r,y:o}),this}_eachAncestorReverse(e,t){var i,r,o=[],s=this.getParent();if(!t||t._id!==this._id){for(o.unshift(this);s&&(!t||s._id!==t._id);)o.unshift(s),s=s.parent;for(i=o.length,r=0;r<i;r++)e(o[r])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return d.warn("Node has no parent. moveToTop function is ignored."),!1;var e=this.index;return e<this.parent.getChildren().length-1&&(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return d.warn("Node has no parent. moveUp function is ignored."),!1;var e=this.index;return e<this.parent.getChildren().length-1&&(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return d.warn("Node has no parent. moveDown function is ignored."),!1;var e=this.index;return e>0&&(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return d.warn("Node has no parent. moveToBottom function is ignored."),!1;var e=this.index;return e>0&&(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(e){if(!this.parent)return d.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&d.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(ie,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var e=this.opacity(),t=this.getParent();return t&&!t._isUnderCache&&(e*=t.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){var e,t,i,r,o={},s=this.getAttrs();for(e in o.attrs={},s)t=s[e],d.isObject(t)&&!d._isPlainObject(t)&&!d._isArray(t)||(i=typeof this[e]=="function"&&this[e],delete s[e],r=i?i.call(this):null,s[e]=t,r!==t&&(o.attrs[e]=t));return o.className=this.getClassName(),d._prepareToStringify(o)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,t,i){var r=[];t&&this._isMatch(e)&&r.push(this);for(var o=this.parent;o;){if(o===i)return r;o._isMatch(e)&&r.push(o),o=o.parent}return r}isAncestorOf(e){return!1}findAncestor(e,t,i){return this.findAncestors(e,t,i)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);var t,i,r=e.replace(/ /g,"").split(","),o=r.length;for(t=0;t<o;t++)if(i=r[t],d.isValidSelector(i)||(d.warn('Selector "'+i+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),d.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),d.warn("Konva is awesome, right?")),i.charAt(0)==="#"){if(this.id()===i.slice(1))return!0}else if(i.charAt(0)==="."){if(this.hasName(i.slice(1)))return!0}else if(this.className===i||this.nodeType===i)return!0;return!1}getLayer(){var e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(wt,this._getStage)}_getStage(){var e=this.getParent();return e?e.getStage():void 0}fire(e,t={},i){return t.target=t.target||this,i?this._fireAndBubble(e,t):this._fire(e,t),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(he,this._getAbsoluteTransform)}_getAbsoluteTransform(e){var t;if(e)return t=new re,this._eachAncestorReverse(function(r){var o=r.transformsEnabled();o==="all"?t.multiply(r.getTransform()):o==="position"&&t.translate(r.x()-r.offsetX(),r.y()-r.offsetY())},e),t;t=this._cache.get(he)||new re,this.parent?this.parent.getAbsoluteTransform().copyInto(t):t.reset();var i=this.transformsEnabled();if(i==="all")t.multiply(this.getTransform());else if(i==="position"){const r=this.attrs.x||0,o=this.attrs.y||0,s=this.attrs.offsetX||0,h=this.attrs.offsetY||0;t.translate(r-s,o-h)}return t.dirty=!1,t}getAbsoluteScale(e){for(var t=this;t;)t._isUnderCache&&(e=t),t=t.getParent();const i=this.getAbsoluteTransform(e).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(De,this._getTransform)}_getTransform(){var e,t,i=this._cache.get(De)||new re;i.reset();var r=this.x(),o=this.y(),s=G.getAngle(this.rotation()),h=(e=this.attrs.scaleX)!==null&&e!==void 0?e:1,l=(t=this.attrs.scaleY)!==null&&t!==void 0?t:1,c=this.attrs.skewX||0,g=this.attrs.skewY||0,v=this.attrs.offsetX||0,E=this.attrs.offsetY||0;return r===0&&o===0||i.translate(r,o),s!==0&&i.rotate(s),c===0&&g===0||i.skew(c,g),h===1&&l===1||i.scale(h,l),v===0&&E===0||i.translate(-1*v,-1*E),i.dirty=!1,i}clone(e){var t,i,r,o,s,h=d.cloneObject(this.attrs);for(t in e)h[t]=e[t];var l=new this.constructor(h);for(t in this.eventListeners)for(r=(i=this.eventListeners[t]).length,o=0;o<r;o++)(s=i[o]).name.indexOf("konva")<0&&(l.eventListeners[t]||(l.eventListeners[t]=[]),l.eventListeners[t].push(s));return l}_toKonvaCanvas(e){e=e||{};var t=this.getClientRect(),i=this.getStage(),r=e.x!==void 0?e.x:Math.floor(t.x),o=e.y!==void 0?e.y:Math.floor(t.y),s=e.pixelRatio||1,h=new Q({width:e.width||Math.ceil(t.width)||(i?i.width():0),height:e.height||Math.ceil(t.height)||(i?i.height():0),pixelRatio:s}),l=h.getContext();return l.save(),(r||o)&&l.translate(-1*r,-1*o),this.drawScene(h),l.restore(),h}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){var t=(e=e||{}).mimeType||null,i=e.quality||null,r=this._toKonvaCanvas(e).toDataURL(t,i);return e.callback&&e.callback(r),r}toImage(e){if(!e||!e.callback)throw"callback required for toImage method config argument";var t=e.callback;delete e.callback,d._urlToImage(this.toDataURL(e),function(i){t(i)})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():G.dragDistance}_off(e,t,i){var r,o,s,h=this.eventListeners[e];for(r=0;r<h.length;r++)if(o=h[r].name,s=h[r].handler,!(o==="konva"&&t!=="konva"||t&&o!==t||i&&i!==s)){if(h.splice(r,1),h.length===0){delete this.eventListeners[e];break}r--}}_fireChangeEvent(e,t,i){this._fire(e+"Change",{oldVal:t,newVal:i})}addName(e){if(!this.hasName(e)){var t=this.name(),i=t?t+" "+e:e;this.name(i)}return this}hasName(e){if(!e)return!1;const t=this.name();return!!t&&(t||"").split(/\s/g).indexOf(e)!==-1}removeName(e){var t=(this.name()||"").split(/\s/g),i=t.indexOf(e);return i!==-1&&(t.splice(i,1),this.name(t.join(" "))),this}setAttr(e,t){var i=this["set"+d._capitalize(e)];return d._isFunction(i)?i.call(this,t):this._setAttr(e,t),this}_requestDraw(){if(G.autoDrawEnabled){const e=this.getLayer()||this.getStage();e==null||e.batchDraw()}}_setAttr(e,t){var i=this.attrs[e];(i!==t||d.isObject(t))&&(t==null?delete this.attrs[e]:this.attrs[e]=t,this._shouldFireChangeEvents&&this._fireChangeEvent(e,i,t),this._requestDraw())}_setComponentAttr(e,t,i){var r;i!==void 0&&((r=this.attrs[e])||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=i,this._fireChangeEvent(e,r,i))}_fireAndBubble(e,t,i){if(t&&this.nodeType===St&&(t.target=this),e!==Ue&&e!==Je||!(i&&(this===i||this.isAncestorOf&&this.isAncestorOf(i))||this.nodeType==="Stage"&&!i)){this._fire(e,t);var r=(e===Ue||e===Je)&&i&&i.isAncestorOf&&i.isAncestorOf(this)&&!i.isAncestorOf(this.parent);(t&&!t.cancelBubble||!t)&&this.parent&&this.parent.isListening()&&!r&&(i&&i.parent?this._fireAndBubble.call(this.parent,e,t,i):this._fireAndBubble.call(this.parent,e,t))}}_getProtoListeners(e){let t=this._cache.get(ne);if(!t){t={};let r=Object.getPrototypeOf(this);for(;r;)if(r.eventListeners){for(var i in r.eventListeners){const o=r.eventListeners[i],s=t[i]||[];t[i]=o.concat(s)}r=Object.getPrototypeOf(r)}else r=Object.getPrototypeOf(r);this._cache.set(ne,t)}return t[e]}_fire(e,t){(t=t||{}).currentTarget=this,t.type=e;const i=this._getProtoListeners(e);if(i)for(var r=0;r<i.length;r++)i[r].handler.call(this,t);const o=this.eventListeners[e];if(o)for(r=0;r<o.length;r++)o[r].handler.call(this,t)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){var t=e?e.pointerId:void 0,i=this.getStage(),r=this.getAbsolutePosition(),o=i._getPointerById(t)||i._changedPointerPositions[0]||r;H._dragElements.set(this._id,{node:this,startPointerPos:o,offset:{x:o.x-r.x,y:o.y-r.y},dragStatus:"ready",pointerId:t})}startDrag(e,t=!0){H._dragElements.has(this._id)||this._createDragElement(e),H._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},t)}_setDragPosition(e,t){const i=this.getStage()._getPointerById(t.pointerId);if(i){var r={x:i.x-t.offset.x,y:i.y-t.offset.y},o=this.dragBoundFunc();if(o!==void 0){const s=o.call(this,r,e);s?r=s:d.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===r.x&&this._lastPos.y===r.y||(this.setAbsolutePosition(r),this._requestDraw()),this._lastPos=r}}stopDrag(e){const t=H._dragElements.get(this._id);t&&(t.dragStatus="stopped"),H._endDragBefore(e),H._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){const e=H._dragElements.get(this._id);return!!e&&e.dragStatus==="dragging"}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){if((e.evt.button===void 0||G.dragButtons.indexOf(e.evt.button)>=0)&&!this.isDragging()){var t=!1;H._dragElements.forEach(i=>{this.isAncestorOf(i.node)&&(t=!0)}),t||this._createDragElement(e)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const e=H._dragElements.get(this._id),t=e&&e.dragStatus==="dragging",i=e&&e.dragStatus==="ready";t?this.stopDrag():i&&H._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){const t=this.getStage();if(!t)return!1;const i={x:-e.x,y:-e.y,width:t.width()+2*e.x,height:t.height()+2*e.y};return d.haveIntersection(i,this.getClientRect())}static create(e,t){return d._isString(e)&&(e=JSON.parse(e)),this._createNode(e,t)}static _createNode(e,t){var i,r,o,s=W.prototype.getClassName.call(e),h=e.children;if(t&&(e.attrs.container=t),G[s]||(d.warn('Can not find a node with class name "'+s+'". Fallback to "Shape".'),s="Shape"),i=new G[s](e.attrs),h)for(r=h.length,o=0;o<r;o++)i.add(W._createNode(h[o]));return i}}W.prototype.nodeType="Node",W.prototype._attrsAffectingSize=[],W.prototype.eventListeners={},W.prototype.on.call(W.prototype,oi,function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache(De),this._clearSelfAndDescendantCache(he))}),W.prototype.on.call(W.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(ht)}),W.prototype.on.call(W.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(Ee)}),W.prototype.on.call(W.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(ie)});const te=u.addGetterSetter;te(W,"zIndex"),te(W,"absolutePosition"),te(W,"position"),te(W,"x",0,f()),te(W,"y",0,f()),te(W,"globalCompositeOperation","source-over",k()),te(W,"opacity",1,f()),te(W,"name","",k()),te(W,"id","",k()),te(W,"rotation",0,f()),u.addComponentsGetterSetter(W,"scale",["x","y"]),te(W,"scaleX",1,f()),te(W,"scaleY",1,f()),u.addComponentsGetterSetter(W,"skew",["x","y"]),te(W,"skewX",0,f()),te(W,"skewY",0,f()),u.addComponentsGetterSetter(W,"offset",["x","y"]),te(W,"offsetX",0,f()),te(W,"offsetY",0,f()),te(W,"dragDistance",null,f()),te(W,"width",0,f()),te(W,"height",0,f()),te(W,"listening",!0,x()),te(W,"preventDefault",!0,x()),te(W,"filters",null,function(a){return this._filterUpToDate=!1,a}),te(W,"visible",!0,x()),te(W,"transformsEnabled","all",k()),te(W,"size"),te(W,"dragBoundFunc"),te(W,"draggable",!1,x()),u.backCompat(W,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class me extends W{constructor(){super(...arguments),this.children=[]}getChildren(e){if(!e)return this.children||[];const t=this.children||[];var i=[];return t.forEach(function(r){e(r)&&i.push(r)}),i}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}var i=e[0];return i.getParent()?(i.moveTo(this),this):(this._validateAdd(i),i.index=this.getChildren().length,i.parent=this,i._clearCaches(),this.getChildren().push(i),this._fire("add",{child:i}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){var t=this._generalFind(e,!0);return t.length>0?t[0]:void 0}_generalFind(e,t){var i=[];return this._descendants(r=>{const o=r._isMatch(e);return o&&i.push(r),!(!o||!t)}),i}_descendants(e){let t=!1;const i=this.getChildren();for(const r of i)if(t=e(r),t||r.hasChildren()&&(t=r._descendants(e),t))return!0;return!1}toObject(){var e=W.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(t=>{e.children.push(t.toObject())}),e}isAncestorOf(e){for(var t=e.getParent();t;){if(t._id===this._id)return!0;t=t.getParent()}return!1}clone(e){var t=W.prototype.clone.call(this,e);return this.getChildren().forEach(function(i){t.add(i.clone())}),t}getAllIntersections(e){var t=[];return this.find("Shape").forEach(function(i){i.isVisible()&&i.intersects(e)&&t.push(i)}),t}_clearSelfAndDescendantCache(e){var t;super._clearSelfAndDescendantCache(e),this.isCached()||(t=this.children)===null||t===void 0||t.forEach(function(i){i._clearSelfAndDescendantCache(e)})}_setChildrenIndices(){var e;(e=this.children)===null||e===void 0||e.forEach(function(t,i){t.index=i}),this._requestDraw()}drawScene(e,t){var i=this.getLayer(),r=e||i&&i.getCanvas(),o=r&&r.getContext(),s=this._getCanvasCache(),h=s&&s.scene,l=r&&r.isCache;if(!this.isVisible()&&!l)return this;if(h){o.save();var c=this.getAbsoluteTransform(t).getMatrix();o.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",r,t);return this}drawHit(e,t){if(!this.shouldDrawHit(t))return this;var i=this.getLayer(),r=e||i&&i.hitCanvas,o=r&&r.getContext(),s=this._getCanvasCache();if(s&&s.hit){o.save();var h=this.getAbsoluteTransform(t).getMatrix();o.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedHitCanvas(o),o.restore()}else this._drawChildren("drawHit",r,t);return this}_drawChildren(e,t,i){var r,o=t&&t.getContext(),s=this.clipWidth(),h=this.clipHeight(),l=this.clipFunc(),c=s&&h||l;const g=i===this;if(c){o.save();var v=this.getAbsoluteTransform(i),E=v.getMatrix();if(o.transform(E[0],E[1],E[2],E[3],E[4],E[5]),o.beginPath(),l)l.call(this,o,this);else{var D=this.clipX(),y=this.clipY();o.rect(D,y,s,h)}o.clip(),E=v.copy().invert().getMatrix(),o.transform(E[0],E[1],E[2],E[3],E[4],E[5])}var U=!g&&this.globalCompositeOperation()!=="source-over"&&e==="drawScene";U&&(o.save(),o._applyGlobalCompositeOperation(this)),(r=this.children)===null||r===void 0||r.forEach(function(ee){ee[e](t,i)}),U&&o.restore(),c&&o.restore()}getClientRect(e){var t,i,r,o,s,h,l=(e=e||{}).skipTransform,c=e.relativeTo,g=this;(t=this.children)===null||t===void 0||t.forEach(function(y){if(y.visible()){var U=y.getClientRect({relativeTo:g,skipShadow:e.skipShadow,skipStroke:e.skipStroke});U.width===0&&U.height===0||(i===void 0?(i=U.x,r=U.y,o=U.x+U.width,s=U.y+U.height):(i=Math.min(i,U.x),r=Math.min(r,U.y),o=Math.max(o,U.x+U.width),s=Math.max(s,U.y+U.height)))}});for(var v=this.find("Shape"),E=!1,D=0;D<v.length;D++)if(v[D]._isVisible(this)){E=!0;break}return h=E&&i!==void 0?{x:i,y:r,width:o-i,height:s-r}:{x:0,y:0,width:0,height:0},l?h:this._transformedRect(h,c)}}u.addComponentsGetterSetter(me,"clip",["x","y","width","height"]),u.addGetterSetter(me,"clipX",void 0,f()),u.addGetterSetter(me,"clipY",void 0,f()),u.addGetterSetter(me,"clipWidth",void 0,f()),u.addGetterSetter(me,"clipHeight",void 0,f()),u.addGetterSetter(me,"clipFunc");const je=new Map,xt=G._global.PointerEvent!==void 0;function lt(a){return je.get(a)}function ct(a){return{evt:a,pointerId:a.pointerId}}function Pt(a,e){return je.get(a)===e}function At(a,e){Ne(a),e.getStage()&&(je.set(a,e),xt&&e._fire("gotpointercapture",ct(new PointerEvent("gotpointercapture"))))}function Ne(a,e){const t=je.get(a);if(!t)return;const i=t.getStage();i&&i.content,je.delete(a),xt&&t._fire("lostpointercapture",ct(new PointerEvent("lostpointercapture")))}var kt="mouseleave",Et="mouseover",It="mouseenter",Tt="mousemove",Dt="mousedown",Rt="mouseup",He="pointermove",We="pointerdown",Me="pointerup",ze="pointercancel",$e="pointerout",et="pointerleave",tt="pointerover",it="pointerenter",dt="contextmenu",Lt="touchstart",Ot="touchend",Gt="touchmove",Mt="touchcancel",ut="wheel",li=[[It,"_pointerenter"],[Dt,"_pointerdown"],[Tt,"_pointermove"],[Rt,"_pointerup"],[kt,"_pointerleave"],[Lt,"_pointerdown"],[Gt,"_pointermove"],[Ot,"_pointerup"],[Mt,"_pointercancel"],[Et,"_pointerover"],[ut,"_wheel"],[dt,"_contextmenu"],[We,"_pointerdown"],[He,"_pointermove"],[Me,"_pointerup"],[ze,"_pointercancel"],["lostpointercapture","_lostpointercapture"]];const gt={mouse:{[$e]:"mouseout",[et]:kt,[tt]:Et,[it]:It,[He]:Tt,[We]:Dt,[Me]:Rt,[ze]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[$e]:"touchout",[et]:"touchleave",[tt]:"touchover",[it]:"touchenter",[He]:Gt,[We]:Lt,[Me]:Ot,[ze]:Mt,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[$e]:$e,[et]:et,[tt]:tt,[it]:it,[He]:He,[We]:We,[Me]:Me,[ze]:ze,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},Ve=a=>a.indexOf("pointer")>=0?"pointer":a.indexOf("touch")>=0?"touch":"mouse",Fe=a=>{const e=Ve(a);return e==="pointer"?G.pointerEventsEnabled&&gt.pointer:e==="touch"?gt.touch:e==="mouse"?gt.mouse:void 0};function Ft(a={}){return(a.clipFunc||a.clipWidth||a.clipHeight)&&d.warn("Stage does not support clipping. Please use clip for Layers or Groups."),a}const rt=[];class nt extends me{constructor(e){super(Ft(e)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),rt.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{Ft(this.attrs)}),this._checkVisibility()}_validateAdd(e){const t=e.getType()==="Layer",i=e.getType()==="FastLayer";t||i||d.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const e=this.visible()?"":"none";this.content.style.display=e}setContainer(e){if(typeof e=="string"){if(e.charAt(0)==="."){var t=e.slice(1);e=document.getElementsByClassName(t)[0]}else{var i;i=e.charAt(0)!=="#"?e:e.slice(1),e=document.getElementById(i)}if(!e)throw"Can not find container in document with id "+i}return this._setAttr("container",e),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),e.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var e,t=this.children,i=t.length;for(e=0;e<i;e++)t[e].clear();return this}clone(e){return e||(e={}),e.container=typeof document<"u"&&document.createElement("div"),me.prototype.clone.call(this,e)}destroy(){super.destroy();var e=this.content;e&&d._isInDocument(e)&&this.container().removeChild(e);var t=rt.indexOf(this);return t>-1&&rt.splice(t,1),this}getPointerPosition(){const e=this._pointerPositions[0]||this._changedPointerPositions[0];return e?{x:e.x,y:e.y}:(d.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(e){return this._pointerPositions.find(t=>t.id===e)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(e){(e=e||{}).x=e.x||0,e.y=e.y||0,e.width=e.width||this.width(),e.height=e.height||this.height();var t=new Q({width:e.width,height:e.height,pixelRatio:e.pixelRatio||1}),i=t.getContext()._context,r=this.children;return(e.x||e.y)&&i.translate(-1*e.x,-1*e.y),r.forEach(function(o){if(o.isVisible()){var s=o._toKonvaCanvas(e);i.drawImage(s._canvas,e.x,e.y,s.getWidth()/s.getPixelRatio(),s.getHeight()/s.getPixelRatio())}}),t}getIntersection(e){if(!e)return null;var t,i=this.children;for(t=i.length-1;t>=0;t--){const r=i[t].getIntersection(e);if(r)return r}return null}_resizeDOM(){var e=this.width(),t=this.height();this.content&&(this.content.style.width=e+"px",this.content.style.height=t+"px"),this.bufferCanvas.setSize(e,t),this.bufferHitCanvas.setSize(e,t),this.children.forEach(i=>{i.setSize({width:e,height:t}),i.draw()})}add(e,...t){if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}super.add(e);var r=this.children.length;return r>5&&d.warn("The stage has "+r+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),e.setSize({width:this.width(),height:this.height()}),e.draw(),G.isBrowser&&this.content.appendChild(e.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(e){return Pt(e,this)}setPointerCapture(e){At(e,this)}releaseCapture(e){Ne(e)}getLayers(){return this.children}_bindContentEvents(){G.isBrowser&&li.forEach(([e,t])=>{this.content.addEventListener(e,i=>{this[t](i)})})}_pointerenter(e){this.setPointersPositions(e);const t=Fe(e.type);this._fire(t.pointerenter,{evt:e,target:this,currentTarget:this})}_pointerover(e){this.setPointersPositions(e);const t=Fe(e.type);this._fire(t.pointerover,{evt:e,target:this,currentTarget:this})}_getTargetShape(e){let t=this[e+"targetShape"];return t&&!t.getStage()&&(t=null),t}_pointerleave(e){const t=Fe(e.type),i=Ve(e.type);if(t){this.setPointersPositions(e);var r=this._getTargetShape(i),o=!H.isDragging||G.hitOnDragEnabled;r&&o?(r._fireAndBubble(t.pointerout,{evt:e}),r._fireAndBubble(t.pointerleave,{evt:e}),this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this[i+"targetShape"]=null):o&&(this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this._fire(t.pointerout,{evt:e,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[]}}_pointerdown(e){const t=Fe(e.type),i=Ve(e.type);if(t){this.setPointersPositions(e);var r=!1;this._changedPointerPositions.forEach(o=>{var s=this.getIntersection(o);if(H.justDragged=!1,G["_"+i+"ListenClick"]=!0,!s||!s.isListening())return;G.capturePointerEventsEnabled&&s.setPointerCapture(o.id),this[i+"ClickStartShape"]=s,s._fireAndBubble(t.pointerdown,{evt:e,pointerId:o.id}),r=!0;const h=e.type.indexOf("touch")>=0;s.preventDefault()&&e.cancelable&&h&&e.preventDefault()}),r||this._fire(t.pointerdown,{evt:e,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(e){const t=Fe(e.type),i=Ve(e.type);if(!t||(H.isDragging&&H.node.preventDefault()&&e.cancelable&&e.preventDefault(),this.setPointersPositions(e),H.isDragging&&!G.hitOnDragEnabled))return;var r={};let o=!1;var s=this._getTargetShape(i);this._changedPointerPositions.forEach(h=>{const l=lt(h.id)||this.getIntersection(h),c=h.id,g={evt:e,pointerId:c};var v=s!==l;if(v&&s&&(s._fireAndBubble(t.pointerout,Object.assign({},g),l),s._fireAndBubble(t.pointerleave,Object.assign({},g),l)),l){if(r[l._id])return;r[l._id]=!0}l&&l.isListening()?(o=!0,v&&(l._fireAndBubble(t.pointerover,Object.assign({},g),s),l._fireAndBubble(t.pointerenter,Object.assign({},g),s),this[i+"targetShape"]=l),l._fireAndBubble(t.pointermove,Object.assign({},g))):s&&(this._fire(t.pointerover,{evt:e,target:this,currentTarget:this,pointerId:c}),this[i+"targetShape"]=null)}),o||this._fire(t.pointermove,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(e){const t=Fe(e.type),i=Ve(e.type);if(!t)return;this.setPointersPositions(e);const r=this[i+"ClickStartShape"],o=this[i+"ClickEndShape"];var s={};let h=!1;this._changedPointerPositions.forEach(l=>{const c=lt(l.id)||this.getIntersection(l);if(c){if(c.releaseCapture(l.id),s[c._id])return;s[c._id]=!0}const g=l.id,v={evt:e,pointerId:g};let E=!1;G["_"+i+"InDblClickWindow"]?(E=!0,clearTimeout(this[i+"DblTimeout"])):H.justDragged||(G["_"+i+"InDblClickWindow"]=!0,clearTimeout(this[i+"DblTimeout"])),this[i+"DblTimeout"]=setTimeout(function(){G["_"+i+"InDblClickWindow"]=!1},G.dblClickWindow),c&&c.isListening()?(h=!0,this[i+"ClickEndShape"]=c,c._fireAndBubble(t.pointerup,Object.assign({},v)),G["_"+i+"ListenClick"]&&r&&r===c&&(c._fireAndBubble(t.pointerclick,Object.assign({},v)),E&&o&&o===c&&c._fireAndBubble(t.pointerdblclick,Object.assign({},v)))):(this[i+"ClickEndShape"]=null,G["_"+i+"ListenClick"]&&this._fire(t.pointerclick,{evt:e,target:this,currentTarget:this,pointerId:g}),E&&this._fire(t.pointerdblclick,{evt:e,target:this,currentTarget:this,pointerId:g}))}),h||this._fire(t.pointerup,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),G["_"+i+"ListenClick"]=!1,e.cancelable&&e.preventDefault()}_contextmenu(e){this.setPointersPositions(e);var t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(dt,{evt:e}):this._fire(dt,{evt:e,target:this,currentTarget:this})}_wheel(e){this.setPointersPositions(e);var t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(ut,{evt:e}):this._fire(ut,{evt:e,target:this,currentTarget:this})}_pointercancel(e){this.setPointersPositions(e);const t=lt(e.pointerId)||this.getIntersection(this.getPointerPosition());t&&t._fireAndBubble(Me,ct(e)),Ne(e.pointerId)}_lostpointercapture(e){Ne(e.pointerId)}setPointersPositions(e){var t=this._getContentPosition(),i=null,r=null;(e=e||window.event).touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(e.touches,o=>{this._pointerPositions.push({id:o.identifier,x:(o.clientX-t.left)/t.scaleX,y:(o.clientY-t.top)/t.scaleY})}),Array.prototype.forEach.call(e.changedTouches||e.touches,o=>{this._changedPointerPositions.push({id:o.identifier,x:(o.clientX-t.left)/t.scaleX,y:(o.clientY-t.top)/t.scaleY})})):(i=(e.clientX-t.left)/t.scaleX,r=(e.clientY-t.top)/t.scaleY,this.pointerPos={x:i,y:r},this._pointerPositions=[{x:i,y:r,id:d._getFirstPointerId(e)}],this._changedPointerPositions=[{x:i,y:r,id:d._getFirstPointerId(e)}])}_setPointerPosition(e){d.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(e)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var e=this.content.getBoundingClientRect();return{top:e.top,left:e.left,scaleX:e.width/this.content.clientWidth||1,scaleY:e.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new Q({width:this.width(),height:this.height()}),this.bufferHitCanvas=new J({pixelRatio:1,width:this.width(),height:this.height()}),G.isBrowser){var e=this.container();if(!e)throw"Stage has no container. A container is required.";e.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),e.appendChild(this.content),this._resizeDOM()}}cache(){return d.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(e){e.batchDraw()}),this}}nt.prototype.nodeType="Stage",K(nt),u.addGetterSetter(nt,"container");var Bt="hasShadow",Ut="shadowRGBA",jt="patternImage",Nt="linearGradient",Ht="radialGradient";let ft;function pt(){return ft||(ft=d.createCanvasElement().getContext("2d"),ft)}const Ye={};class F extends W{constructor(e){let t;for(super(e);t=d.getRandomColor(),!t||t in Ye;);this.colorKey=t,Ye[t]=this}getContext(){return d.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return d.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Bt,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(jt,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const e=pt().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(e&&e.setTransform){const t=new re;t.translate(this.fillPatternX(),this.fillPatternY()),t.rotate(G.getAngle(this.fillPatternRotation())),t.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),t.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const i=t.getMatrix(),r=typeof DOMMatrix>"u"?{a:i[0],b:i[1],c:i[2],d:i[3],e:i[4],f:i[5]}:new DOMMatrix(i);e.setTransform(r)}return e}}_getLinearGradient(){return this._getCache(Nt,this.__getLinearGradient)}__getLinearGradient(){var e=this.fillLinearGradientColorStops();if(e){for(var t=pt(),i=this.fillLinearGradientStartPoint(),r=this.fillLinearGradientEndPoint(),o=t.createLinearGradient(i.x,i.y,r.x,r.y),s=0;s<e.length;s+=2)o.addColorStop(e[s],e[s+1]);return o}}_getRadialGradient(){return this._getCache(Ht,this.__getRadialGradient)}__getRadialGradient(){var e=this.fillRadialGradientColorStops();if(e){for(var t=pt(),i=this.fillRadialGradientStartPoint(),r=this.fillRadialGradientEndPoint(),o=t.createRadialGradient(i.x,i.y,this.fillRadialGradientStartRadius(),r.x,r.y,this.fillRadialGradientEndRadius()),s=0;s<e.length;s+=2)o.addColorStop(e[s],e[s+1]);return o}}getShadowRGBA(){return this._getCache(Ut,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var e=d.colorToRGBA(this.shadowColor());return"rgba("+e.r+","+e.g+","+e.b+","+e.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops()))}hasHitStroke(){const e=this.hitStrokeWidth();return e==="auto"?this.hasStroke():this.strokeEnabled()&&!!e}intersects(e){var t=this.getStage().bufferHitCanvas;return t.getContext().clear(),this.drawHit(t,null,!0),t.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data[3]>0}destroy(){return W.prototype.destroy.call(this),delete Ye[this.colorKey],delete this.colorKey,this}_useBufferCanvas(e){var t;if(!this.getStage()||(t=this.attrs.perfectDrawEnabled)!==null&&t!==void 0&&!t)return!1;const i=e||this.hasFill(),r=this.hasStroke(),o=this.getAbsoluteOpacity()!==1;if(i&&r&&o)return!0;const s=this.hasShadow(),h=this.shadowForStrokeEnabled();return!!(i&&r&&s&&h)}setStrokeHitEnabled(e){d.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),e?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var e=this.size();return{x:this._centroid?-e.width/2:0,y:this._centroid?-e.height/2:0,width:e.width,height:e.height}}getClientRect(e={}){const t=e.skipTransform,i=e.relativeTo,r=this.getSelfRect(),o=!e.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,s=r.width+o,h=r.height+o,l=!e.skipShadow&&this.hasShadow(),c=l?this.shadowOffsetX():0,g=l?this.shadowOffsetY():0,v=s+Math.abs(c),E=h+Math.abs(g),D=l&&this.shadowBlur()||0,y={width:v+2*D,height:E+2*D,x:-(o/2+D)+Math.min(c,0)+r.x,y:-(o/2+D)+Math.min(g,0)+r.y};return t?y:this._transformedRect(y,i)}drawScene(e,t){var i,r,o=this.getLayer(),s=e||o.getCanvas(),h=s.getContext(),l=this._getCanvasCache(),c=this.getSceneFunc(),g=this.hasShadow(),v=s.isCache,E=t===this;if(!this.isVisible()&&!E)return this;if(l){h.save();var D=this.getAbsoluteTransform(t).getMatrix();return h.transform(D[0],D[1],D[2],D[3],D[4],D[5]),this._drawCachedSceneCanvas(h),h.restore(),this}if(!c)return this;if(h.save(),this._useBufferCanvas()&&!v){(r=(i=this.getStage().bufferCanvas).getContext()).clear(),r.save(),r._applyLineJoin(this);var y=this.getAbsoluteTransform(t).getMatrix();r.transform(y[0],y[1],y[2],y[3],y[4],y[5]),c.call(this,r,this),r.restore();var U=i.pixelRatio;g&&h._applyShadow(this),h._applyOpacity(this),h._applyGlobalCompositeOperation(this),h.drawImage(i._canvas,0,0,i.width/U,i.height/U)}else h._applyLineJoin(this),E||(y=this.getAbsoluteTransform(t).getMatrix(),h.transform(y[0],y[1],y[2],y[3],y[4],y[5]),h._applyOpacity(this),h._applyGlobalCompositeOperation(this)),g&&h._applyShadow(this),c.call(this,h,this);return h.restore(),this}drawHit(e,t,i=!1){if(!this.shouldDrawHit(t,i))return this;var r=this.getLayer(),o=e||r.hitCanvas,s=o&&o.getContext(),h=this.hitFunc()||this.sceneFunc(),l=this._getCanvasCache(),c=l&&l.hit;if(this.colorKey||d.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),c){s.save();var g=this.getAbsoluteTransform(t).getMatrix();return s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._drawCachedHitCanvas(s),s.restore(),this}if(!h)return this;if(s.save(),s._applyLineJoin(this),this!==t){var v=this.getAbsoluteTransform(t).getMatrix();s.transform(v[0],v[1],v[2],v[3],v[4],v[5])}return h.call(this,s,this),s.restore(),this}drawHitFromCache(e=0){var t,i,r,o,s,h=this._getCanvasCache(),l=this._getCachedSceneCanvas(),c=h.hit,g=c.getContext(),v=c.getWidth(),E=c.getHeight();g.clear(),g.drawImage(l._canvas,0,0,v,E);try{for(r=(i=(t=g.getImageData(0,0,v,E)).data).length,o=d._hexToRgb(this.colorKey),s=0;s<r;s+=4)i[s+3]>e?(i[s]=o.r,i[s+1]=o.g,i[s+2]=o.b,i[s+3]=255):i[s+3]=0;g.putImageData(t,0,0)}catch(D){d.error("Unable to draw hit graph from cached scene canvas. "+D.message)}return this}hasPointerCapture(e){return Pt(e,this)}setPointerCapture(e){At(e,this)}releaseCapture(e){Ne(e)}}F.prototype._fillFunc=function(a){a.fill()},F.prototype._strokeFunc=function(a){a.stroke()},F.prototype._fillFuncHit=function(a){a.fill()},F.prototype._strokeFuncHit=function(a){a.stroke()},F.prototype._centroid=!1,F.prototype.nodeType="Shape",K(F),F.prototype.eventListeners={},F.prototype.on.call(F.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(Bt)}),F.prototype.on.call(F.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(Ut)}),F.prototype.on.call(F.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",function(){this._clearCache(jt)}),F.prototype.on.call(F.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",function(){this._clearCache(Nt)}),F.prototype.on.call(F.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",function(){this._clearCache(Ht)}),u.addGetterSetter(F,"stroke",void 0,R()),u.addGetterSetter(F,"strokeWidth",2,f()),u.addGetterSetter(F,"fillAfterStrokeEnabled",!1),u.addGetterSetter(F,"hitStrokeWidth","auto",function(){if(G.isUnminified)return function(a,e){return d._isNumber(a)||a==="auto"||d.warn(P(a)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),a}}()),u.addGetterSetter(F,"strokeHitEnabled",!0,x()),u.addGetterSetter(F,"perfectDrawEnabled",!0,x()),u.addGetterSetter(F,"shadowForStrokeEnabled",!0,x()),u.addGetterSetter(F,"lineJoin"),u.addGetterSetter(F,"lineCap"),u.addGetterSetter(F,"sceneFunc"),u.addGetterSetter(F,"hitFunc"),u.addGetterSetter(F,"dash"),u.addGetterSetter(F,"dashOffset",0,f()),u.addGetterSetter(F,"shadowColor",void 0,k()),u.addGetterSetter(F,"shadowBlur",0,f()),u.addGetterSetter(F,"shadowOpacity",1,f()),u.addComponentsGetterSetter(F,"shadowOffset",["x","y"]),u.addGetterSetter(F,"shadowOffsetX",0,f()),u.addGetterSetter(F,"shadowOffsetY",0,f()),u.addGetterSetter(F,"fillPatternImage"),u.addGetterSetter(F,"fill",void 0,R()),u.addGetterSetter(F,"fillPatternX",0,f()),u.addGetterSetter(F,"fillPatternY",0,f()),u.addGetterSetter(F,"fillLinearGradientColorStops"),u.addGetterSetter(F,"strokeLinearGradientColorStops"),u.addGetterSetter(F,"fillRadialGradientStartRadius",0),u.addGetterSetter(F,"fillRadialGradientEndRadius",0),u.addGetterSetter(F,"fillRadialGradientColorStops"),u.addGetterSetter(F,"fillPatternRepeat","repeat"),u.addGetterSetter(F,"fillEnabled",!0),u.addGetterSetter(F,"strokeEnabled",!0),u.addGetterSetter(F,"shadowEnabled",!0),u.addGetterSetter(F,"dashEnabled",!0),u.addGetterSetter(F,"strokeScaleEnabled",!0),u.addGetterSetter(F,"fillPriority","color"),u.addComponentsGetterSetter(F,"fillPatternOffset",["x","y"]),u.addGetterSetter(F,"fillPatternOffsetX",0,f()),u.addGetterSetter(F,"fillPatternOffsetY",0,f()),u.addComponentsGetterSetter(F,"fillPatternScale",["x","y"]),u.addGetterSetter(F,"fillPatternScaleX",1,f()),u.addGetterSetter(F,"fillPatternScaleY",1,f()),u.addComponentsGetterSetter(F,"fillLinearGradientStartPoint",["x","y"]),u.addComponentsGetterSetter(F,"strokeLinearGradientStartPoint",["x","y"]),u.addGetterSetter(F,"fillLinearGradientStartPointX",0),u.addGetterSetter(F,"strokeLinearGradientStartPointX",0),u.addGetterSetter(F,"fillLinearGradientStartPointY",0),u.addGetterSetter(F,"strokeLinearGradientStartPointY",0),u.addComponentsGetterSetter(F,"fillLinearGradientEndPoint",["x","y"]),u.addComponentsGetterSetter(F,"strokeLinearGradientEndPoint",["x","y"]),u.addGetterSetter(F,"fillLinearGradientEndPointX",0),u.addGetterSetter(F,"strokeLinearGradientEndPointX",0),u.addGetterSetter(F,"fillLinearGradientEndPointY",0),u.addGetterSetter(F,"strokeLinearGradientEndPointY",0),u.addComponentsGetterSetter(F,"fillRadialGradientStartPoint",["x","y"]),u.addGetterSetter(F,"fillRadialGradientStartPointX",0),u.addGetterSetter(F,"fillRadialGradientStartPointY",0),u.addComponentsGetterSetter(F,"fillRadialGradientEndPoint",["x","y"]),u.addGetterSetter(F,"fillRadialGradientEndPointX",0),u.addGetterSetter(F,"fillRadialGradientEndPointY",0),u.addGetterSetter(F,"fillPatternRotation",0),u.backCompat(F,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});var Wt=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],ci=Wt.length;class Re extends me{constructor(e){super(e),this.canvas=new Q,this.hitCanvas=new J({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}setZIndex(e){super.setZIndex(e);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),e<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[e+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){W.prototype.moveToTop.call(this);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!W.prototype.moveUp.call(this))return!1;var e=this.getStage();return!(!e||!e.content||(e.content.removeChild(this.getNativeCanvasElement()),this.index<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement()),0))}moveDown(){if(W.prototype.moveDown.call(this)){var e=this.getStage();if(e){var t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(W.prototype.moveToBottom.call(this)){var e=this.getStage();if(e){var t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var e=this.getNativeCanvasElement();return W.prototype.remove.call(this),e&&e.parentNode&&d._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:e,height:t}){return this.canvas.setSize(e,t),this.hitCanvas.setSize(e,t),this._setSmoothEnabled(),this}_validateAdd(e){var t=e.getType();t!=="Group"&&t!=="Shape"&&d.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(e){return(e=e||{}).width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=e.x!==void 0?e.x:this.x(),e.y=e.y!==void 0?e.y:this.y(),W.prototype._toKonvaCanvas.call(this,e)}_checkVisibility(){const e=this.visible();this.canvas._canvas.style.display=e?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){d.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){d.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,d.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(e){if(!this.isListening()||!this.isVisible())return null;for(var t=1,i=!1;;){for(let r=0;r<ci;r++){const o=Wt[r],s=this._getIntersection({x:e.x+o.x*t,y:e.y+o.y*t}),h=s.shape;if(h)return h;if(i=!!s.antialiased,!s.antialiased)break}if(!i)return null;t+=1}}_getIntersection(e){const t=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(e.x*t),Math.round(e.y*t),1,1).data,r=i[3];if(r===255){const o=d._rgbToHex(i[0],i[1],i[2]),s=Ye["#"+o];return s?{shape:s}:{antialiased:!0}}return r>0?{antialiased:!0}:{}}drawScene(e,t){var i=this.getLayer(),r=e||i&&i.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&r.getContext().clear(),me.prototype.drawScene.call(this,r,t),this._fire("draw",{node:this}),this}drawHit(e,t){var i=this.getLayer(),r=e||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),me.prototype.drawHit.call(this,r,t),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){d.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return d.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(this.parent&&this.parent.content){var e=this.parent;this.hitCanvas._canvas.parentNode?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}}}Re.prototype.nodeType="Layer",K(Re),u.addGetterSetter(Re,"imageSmoothingEnabled",!0),u.addGetterSetter(Re,"clearBeforeDraw",!0),u.addGetterSetter(Re,"hitGraphEnabled",!0,x());class mt extends Re{constructor(e){super(e),this.listening(!1),d.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}mt.prototype.nodeType="FastLayer",K(mt);class vt extends me{_validateAdd(e){var t=e.getType();t!=="Group"&&t!=="Shape"&&d.throw("You may only add groups and shapes to groups.")}}vt.prototype.nodeType="Group",K(vt);var yt=j.performance&&j.performance.now?function(){return j.performance.now()}:function(){return new Date().getTime()};class be{constructor(e,t){this.id=be.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:yt(),frameRate:0},this.func=e,this.setLayers(t)}setLayers(e){var t;return t=e?e.length>0?e:[e]:[],this.layers=t,this}getLayers(){return this.layers}addLayer(e){var t,i=this.layers,r=i.length;for(t=0;t<r;t++)if(i[t]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){var e,t=be.animations,i=t.length;for(e=0;e<i;e++)if(t[e].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=yt(),be._addAnimation(this),this}stop(){return be._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){var t,i=e.id,r=this.animations,o=r.length;for(t=0;t<o;t++)if(r[t].id===i){this.animations.splice(t,1);break}}static _runFrames(){var e,t,i,r,o,s,h,l,c={},g=this.animations;for(r=0;r<g.length;r++)if(t=(e=g[r]).layers,i=e.func,e._updateFrameObject(yt()),s=t.length,!i||i.call(e,e.frame)!==!1)for(o=0;o<s;o++)(h=t[o])._id!==void 0&&(c[h._id]=h);for(l in c)c.hasOwnProperty(l)&&c[l].batchDraw()}static _animationLoop(){var e=be;e.animations.length?(e._runFrames(),d.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,d.requestAnimFrame(this._animationLoop))}}be.animations=[],be.animIdCounter=0,be.animRunning=!1;var di={node:1,duration:1,easing:1,onFinish:1,yoyo:1},ui=0,zt=["fill","stroke","shadowColor"];class gi{constructor(e,t,i,r,o,s,h){this.prop=e,this.propFunc=t,this.begin=r,this._pos=r,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=h,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=i,this._change=o-this.begin,this.pause()}fire(e){var t=this[e];t&&t()}setTime(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():e<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())}getTime(){return this._time}setPosition(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e}getPosition(e){return e===void 0&&(e=this._time),this.func(e,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var e=this.getTimer()-this._startTime;this.state===2?this.setTime(e):this.state===3&&this.setTime(this.duration-e)}pause(){this.state=1,this.fire("onPause")}getTimer(){return new Date().getTime()}}class ae{constructor(e){var t,i,r=this,o=e.node,s=o._id,h=e.easing||Xe.Linear,l=!!e.yoyo;t=e.duration===void 0?.3:e.duration===0?.001:e.duration,this.node=o,this._id=ui++;var c=o.getLayer()||(o instanceof G.Stage?o.getLayers():null);for(i in c||d.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new be(function(){r.tween.onEnterFrame()},c),this.tween=new gi(i,function(g){r._tweenFunc(g)},h,0,1,1e3*t,l),this._addListeners(),ae.attrs[s]||(ae.attrs[s]={}),ae.attrs[s][this._id]||(ae.attrs[s][this._id]={}),ae.tweens[s]||(ae.tweens[s]={}),e)di[i]===void 0&&this._addAttr(i,e[i]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset,this.onUpdate=e.onUpdate}_addAttr(e,t){var i,r,o,s,h,l,c,g,v=this.node,E=v._id;if((o=ae.tweens[E][e])&&delete ae.attrs[E][o][e],i=v.getAttr(e),d._isArray(t))if(r=[],h=Math.max(t.length,i.length),e==="points"&&t.length!==i.length&&(t.length>i.length?(c=i,i=d._prepareArrayForTween(i,t,v.closed())):(l=t,t=d._prepareArrayForTween(t,i,v.closed()))),e.indexOf("fill")===0)for(s=0;s<h;s++)if(s%2==0)r.push(t[s]-i[s]);else{var D=d.colorToRGBA(i[s]);g=d.colorToRGBA(t[s]),i[s]=D,r.push({r:g.r-D.r,g:g.g-D.g,b:g.b-D.b,a:g.a-D.a})}else for(s=0;s<h;s++)r.push(t[s]-i[s]);else zt.indexOf(e)!==-1?(i=d.colorToRGBA(i),r={r:(g=d.colorToRGBA(t)).r-i.r,g:g.g-i.g,b:g.b-i.b,a:g.a-i.a}):r=t-i;ae.attrs[E][this._id][e]={start:i,diff:r,end:t,trueEnd:l,trueStart:c},ae.tweens[E][e]=this._id}_tweenFunc(e){var t,i,r,o,s,h,l,c,g=this.node,v=ae.attrs[g._id][this._id];for(t in v){if(r=(i=v[t]).start,o=i.diff,c=i.end,d._isArray(r))if(s=[],l=Math.max(r.length,c.length),t.indexOf("fill")===0)for(h=0;h<l;h++)h%2==0?s.push((r[h]||0)+o[h]*e):s.push("rgba("+Math.round(r[h].r+o[h].r*e)+","+Math.round(r[h].g+o[h].g*e)+","+Math.round(r[h].b+o[h].b*e)+","+(r[h].a+o[h].a*e)+")");else for(h=0;h<l;h++)s.push((r[h]||0)+o[h]*e);else s=zt.indexOf(t)!==-1?"rgba("+Math.round(r.r+o.r*e)+","+Math.round(r.g+o.g*e)+","+Math.round(r.b+o.b*e)+","+(r.a+o.a*e)+")":r+o*e;g.setAttr(t,s)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var e=this.node,t=ae.attrs[e._id][this._id];t.points&&t.points.trueEnd&&e.setAttr("points",t.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var e=this.node,t=ae.attrs[e._id][this._id];t.points&&t.points.trueStart&&e.points(t.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(e){return this.tween.seek(1e3*e),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var e,t=this.node._id,i=this._id,r=ae.tweens[t];for(e in this.pause(),r)delete ae.tweens[t][e];delete ae.attrs[t][i]}}ae.attrs={},ae.tweens={},W.prototype.to=function(a){var e=a.onFinish;a.node=this,a.onFinish=function(){this.destroy(),e&&e()},new ae(a).play()};const Xe={BackEaseIn(a,e,t,i){var r=1.70158;return t*(a/=i)*a*((r+1)*a-r)+e},BackEaseOut(a,e,t,i){var r=1.70158;return t*((a=a/i-1)*a*((r+1)*a+r)+1)+e},BackEaseInOut(a,e,t,i){var r=1.70158;return(a/=i/2)<1?t/2*(a*a*((1+(r*=1.525))*a-r))+e:t/2*((a-=2)*a*((1+(r*=1.525))*a+r)+2)+e},ElasticEaseIn(a,e,t,i,r,o){var s=0;return a===0?e:(a/=i)==1?e+t:(o||(o=.3*i),!r||r<Math.abs(t)?(r=t,s=o/4):s=o/(2*Math.PI)*Math.asin(t/r),-r*Math.pow(2,10*(a-=1))*Math.sin((a*i-s)*(2*Math.PI)/o)+e)},ElasticEaseOut(a,e,t,i,r,o){var s=0;return a===0?e:(a/=i)==1?e+t:(o||(o=.3*i),!r||r<Math.abs(t)?(r=t,s=o/4):s=o/(2*Math.PI)*Math.asin(t/r),r*Math.pow(2,-10*a)*Math.sin((a*i-s)*(2*Math.PI)/o)+t+e)},ElasticEaseInOut(a,e,t,i,r,o){var s=0;return a===0?e:(a/=i/2)==2?e+t:(o||(o=i*(.3*1.5)),!r||r<Math.abs(t)?(r=t,s=o/4):s=o/(2*Math.PI)*Math.asin(t/r),a<1?r*Math.pow(2,10*(a-=1))*Math.sin((a*i-s)*(2*Math.PI)/o)*-.5+e:r*Math.pow(2,-10*(a-=1))*Math.sin((a*i-s)*(2*Math.PI)/o)*.5+t+e)},BounceEaseOut:(a,e,t,i)=>(a/=i)<1/2.75?t*(7.5625*a*a)+e:a<2/2.75?t*(7.5625*(a-=1.5/2.75)*a+.75)+e:a<2.5/2.75?t*(7.5625*(a-=2.25/2.75)*a+.9375)+e:t*(7.5625*(a-=2.625/2.75)*a+.984375)+e,BounceEaseIn:(a,e,t,i)=>t-Xe.BounceEaseOut(i-a,0,t,i)+e,BounceEaseInOut:(a,e,t,i)=>a<i/2?.5*Xe.BounceEaseIn(2*a,0,t,i)+e:.5*Xe.BounceEaseOut(2*a-i,0,t,i)+.5*t+e,EaseIn:(a,e,t,i)=>t*(a/=i)*a+e,EaseOut:(a,e,t,i)=>-t*(a/=i)*(a-2)+e,EaseInOut:(a,e,t,i)=>(a/=i/2)<1?t/2*a*a+e:-t/2*(--a*(a-2)-1)+e,StrongEaseIn:(a,e,t,i)=>t*(a/=i)*a*a*a*a+e,StrongEaseOut:(a,e,t,i)=>t*((a=a/i-1)*a*a*a*a+1)+e,StrongEaseInOut:(a,e,t,i)=>(a/=i/2)<1?t/2*a*a*a*a*a+e:t/2*((a-=2)*a*a*a*a+2)+e,Linear:(a,e,t,i)=>t*a/i+e},Ie=d._assign(G,{Util:d,Transform:re,Node:W,Container:me,Stage:nt,stages:rt,Layer:Re,FastLayer:mt,Group:vt,DD:H,Shape:F,shapes:Ye,Animation:be,Tween:ae,Easings:Xe,Context:I,Canvas:z});var fi=ue(918),Vt=ue.n(fi),pi=ue(303),mi=ue.n(pi);class Pe extends F{constructor(e){super(e),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const e=this.image();e&&e.complete||e&&e.readyState===4||e&&e.addEventListener&&e.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){return super._useBufferCanvas(!0)}_sceneFunc(e){const t=this.getWidth(),i=this.getHeight(),r=this.attrs.image;let o;if(r){const s=this.attrs.cropWidth,h=this.attrs.cropHeight;o=s&&h?[r,this.cropX(),this.cropY(),s,h,0,0,t,i]:[r,0,0,t,i]}(this.hasFill()||this.hasStroke())&&(e.beginPath(),e.rect(0,0,t,i),e.closePath(),e.fillStrokeShape(this)),r&&e.drawImage.apply(e,o)}_hitFunc(e){var t=this.width(),i=this.height();e.beginPath(),e.rect(0,0,t,i),e.closePath(),e.fillStrokeShape(this)}getWidth(){var e,t;return(e=this.attrs.width)!==null&&e!==void 0?e:(t=this.image())===null||t===void 0?void 0:t.width}getHeight(){var e,t;return(e=this.attrs.height)!==null&&e!==void 0?e:(t=this.image())===null||t===void 0?void 0:t.height}static fromURL(e,t,i=null){var r=d.createImageElement();r.onload=function(){var o=new Pe({image:r});t(o)},r.onerror=i,r.crossOrigin="Anonymous",r.src=e}}Pe.prototype.className="Image",K(Pe),u.addGetterSetter(Pe,"image"),u.addComponentsGetterSetter(Pe,"crop",["x","y","width","height"]),u.addGetterSetter(Pe,"cropX",0,f()),u.addGetterSetter(Pe,"cropY",0,f()),u.addGetterSetter(Pe,"cropWidth",0,f()),u.addGetterSetter(Pe,"cropHeight",0,f());class Qe extends F{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,2*Math.PI,!1),e.closePath(),e.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(e){this.radius()!==e/2&&this.radius(e/2)}setHeight(e){this.radius()!==e/2&&this.radius(e/2)}}Qe.prototype._centroid=!0,Qe.prototype.className="Circle",Qe.prototype._attrsAffectingSize=["radius"],K(Qe),u.addGetterSetter(Qe,"radius",0,f());class bt extends F{_sceneFunc(e){var t=this.cornerRadius(),i=this.width(),r=this.height();if(e.beginPath(),t){let o=0,s=0,h=0,l=0;typeof t=="number"?o=s=h=l=Math.min(t,i/2,r/2):(o=Math.min(t[0]||0,i/2,r/2),s=Math.min(t[1]||0,i/2,r/2),l=Math.min(t[2]||0,i/2,r/2),h=Math.min(t[3]||0,i/2,r/2)),e.moveTo(o,0),e.lineTo(i-s,0),e.arc(i-s,s,s,3*Math.PI/2,0,!1),e.lineTo(i,r-l),e.arc(i-l,r-l,l,0,Math.PI/2,!1),e.lineTo(h,r),e.arc(h,r-h,h,Math.PI/2,Math.PI,!1),e.lineTo(0,o),e.arc(o,o,o,Math.PI,3*Math.PI/2,!1)}else e.rect(0,0,i,r);e.closePath(),e.fillStrokeShape(this)}}bt.prototype.className="Rect",K(bt),u.addGetterSetter(bt,"cornerRadius",0,function(a){if(G.isUnminified)return function(e,t){let i=d._isNumber(e),r=d._isArray(e)&&e.length==4;return i||r||d.warn(P(e)+' is a not valid value for "'+t+'" attribute. The value should be a number or Array<number>(4)'),e}}());class pe extends F{constructor(e){super(e),this.dataArray=[],this.pathLength=0,this.dataArray=pe.parsePathData(this.data()),this.pathLength=0;for(var t=0;t<this.dataArray.length;++t)this.pathLength+=this.dataArray[t].pathLength;this.on("dataChange.konva",function(){this.dataArray=pe.parsePathData(this.data()),this.pathLength=0;for(var i=0;i<this.dataArray.length;++i)this.pathLength+=this.dataArray[i].pathLength})}_sceneFunc(e){var t=this.dataArray;e.beginPath();for(var i=!1,r=0;r<t.length;r++){var o=t[r].command,s=t[r].points;switch(o){case"L":e.lineTo(s[0],s[1]);break;case"M":e.moveTo(s[0],s[1]);break;case"C":e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":e.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":var h=s[0],l=s[1],c=s[2],g=s[3],v=s[4],E=s[5],D=s[6],y=s[7],U=c>g?c:g,ee=c>g?1:c/g,ge=c>g?g/c:1;e.translate(h,l),e.rotate(D),e.scale(ee,ge),e.arc(0,0,U,v,v+E,1-y),e.scale(1/ee,1/ge),e.rotate(-D),e.translate(-h,-l);break;case"z":i=!0,e.closePath()}}i||this.hasFill()?e.fillStrokeShape(this):e.strokeShape(this)}getSelfRect(){var e=[];this.dataArray.forEach(function(c){if(c.command==="A"){var g=c.points[4],v=c.points[5],E=c.points[4]+v,D=Math.PI/180;if(Math.abs(g-E)<D&&(D=Math.abs(g-E)),v<0)for(let y=g-D;y>E;y-=D){const U=pe.getPointOnEllipticalArc(c.points[0],c.points[1],c.points[2],c.points[3],y,0);e.push(U.x,U.y)}else for(let y=g+D;y<E;y+=D){const U=pe.getPointOnEllipticalArc(c.points[0],c.points[1],c.points[2],c.points[3],y,0);e.push(U.x,U.y)}}else if(c.command==="C")for(let y=0;y<=1;y+=.01){const U=pe.getPointOnCubicBezier(y,c.start.x,c.start.y,c.points[0],c.points[1],c.points[2],c.points[3],c.points[4],c.points[5]);e.push(U.x,U.y)}else e=e.concat(c.points)});for(var t,i,r=e[0],o=e[0],s=e[1],h=e[1],l=0;l<e.length/2;l++)t=e[2*l],i=e[2*l+1],isNaN(t)||(r=Math.min(r,t),o=Math.max(o,t)),isNaN(i)||(s=Math.min(s,i),h=Math.max(h,i));return{x:r,y:s,width:o-r,height:h-s}}getLength(){return this.pathLength}getPointAtLength(e){var t,i=0,r=this.dataArray.length;if(!r)return null;for(;i<r&&e>this.dataArray[i].pathLength;)e-=this.dataArray[i].pathLength,++i;if(i===r)return{x:(t=this.dataArray[i-1].points.slice(-2))[0],y:t[1]};if(e<.01)return{x:(t=this.dataArray[i].points.slice(0,2))[0],y:t[1]};var o=this.dataArray[i],s=o.points;switch(o.command){case"L":return pe.getPointOnLine(e,o.start.x,o.start.y,s[0],s[1]);case"C":return pe.getPointOnCubicBezier(e/o.pathLength,o.start.x,o.start.y,s[0],s[1],s[2],s[3],s[4],s[5]);case"Q":return pe.getPointOnQuadraticBezier(e/o.pathLength,o.start.x,o.start.y,s[0],s[1],s[2],s[3]);case"A":var h=s[0],l=s[1],c=s[2],g=s[3],v=s[4],E=s[5],D=s[6];return v+=E*e/o.pathLength,pe.getPointOnEllipticalArc(h,l,c,g,v,D)}return null}static getLineLength(e,t,i,r){return Math.sqrt((i-e)*(i-e)+(r-t)*(r-t))}static getPointOnLine(e,t,i,r,o,s,h){s===void 0&&(s=t),h===void 0&&(h=i);var l=(o-i)/(r-t+1e-8),c=Math.sqrt(e*e/(1+l*l));r<t&&(c*=-1);var g,v=l*c;if(r===t)g={x:s,y:h+v};else if((h-i)/(s-t+1e-8)===l)g={x:s+c,y:h+v};else{var E,D,y=this.getLineLength(t,i,r,o),U=(s-t)*(r-t)+(h-i)*(o-i);E=t+(U/=y*y)*(r-t),D=i+U*(o-i);var ee=this.getLineLength(s,h,E,D),ge=Math.sqrt(e*e-ee*ee);c=Math.sqrt(ge*ge/(1+l*l)),r<t&&(c*=-1),g={x:E+c,y:D+(v=l*c)}}return g}static getPointOnCubicBezier(e,t,i,r,o,s,h,l,c){function g(y){return y*y*y}function v(y){return 3*y*y*(1-y)}function E(y){return 3*y*(1-y)*(1-y)}function D(y){return(1-y)*(1-y)*(1-y)}return{x:l*g(e)+s*v(e)+r*E(e)+t*D(e),y:c*g(e)+h*v(e)+o*E(e)+i*D(e)}}static getPointOnQuadraticBezier(e,t,i,r,o,s,h){function l(v){return v*v}function c(v){return 2*v*(1-v)}function g(v){return(1-v)*(1-v)}return{x:s*l(e)+r*c(e)+t*g(e),y:h*l(e)+o*c(e)+i*g(e)}}static getPointOnEllipticalArc(e,t,i,r,o,s){var h=Math.cos(s),l=Math.sin(s),c=i*Math.cos(o),g=r*Math.sin(o);return{x:e+(c*h-g*l),y:t+(c*l+g*h)}}static parsePathData(e){if(!e)return[];var t=e,i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(var r=0;r<i.length;r++)t=t.replace(new RegExp(i[r],"g"),"|"+i[r]);var o,s=t.split("|"),h=[],l=[],c=0,g=0,v=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;for(r=1;r<s.length;r++){var E=s[r],D=E.charAt(0);for(E=E.slice(1),l.length=0;o=v.exec(E);)l.push(o[0]);for(var y=[],U=0,ee=l.length;U<ee;U++)if(l[U]!=="00"){var ge=parseFloat(l[U]);isNaN(ge)?y.push(0):y.push(ge)}else y.push(0,0);for(;y.length>0&&!isNaN(y[0]);){var se,ce,oe,Ae,Te,_e,Ce,fe,de,X,Z=null,$=[],Le=c,st=g;switch(D){case"l":c+=y.shift(),g+=y.shift(),Z="L",$.push(c,g);break;case"L":c=y.shift(),g=y.shift(),$.push(c,g);break;case"m":var ot=y.shift(),qe=y.shift();if(c+=ot,g+=qe,Z="M",h.length>2&&h[h.length-1].command==="z"){for(var Oe=h.length-2;Oe>=0;Oe--)if(h[Oe].command==="M"){c=h[Oe].points[0]+ot,g=h[Oe].points[1]+qe;break}}$.push(c,g),D="l";break;case"M":c=y.shift(),g=y.shift(),Z="M",$.push(c,g),D="L";break;case"h":c+=y.shift(),Z="L",$.push(c,g);break;case"H":c=y.shift(),Z="L",$.push(c,g);break;case"v":g+=y.shift(),Z="L",$.push(c,g);break;case"V":g=y.shift(),Z="L",$.push(c,g);break;case"C":$.push(y.shift(),y.shift(),y.shift(),y.shift()),c=y.shift(),g=y.shift(),$.push(c,g);break;case"c":$.push(c+y.shift(),g+y.shift(),c+y.shift(),g+y.shift()),c+=y.shift(),g+=y.shift(),Z="C",$.push(c,g);break;case"S":ce=c,oe=g,(se=h[h.length-1]).command==="C"&&(ce=c+(c-se.points[2]),oe=g+(g-se.points[3])),$.push(ce,oe,y.shift(),y.shift()),c=y.shift(),g=y.shift(),Z="C",$.push(c,g);break;case"s":ce=c,oe=g,(se=h[h.length-1]).command==="C"&&(ce=c+(c-se.points[2]),oe=g+(g-se.points[3])),$.push(ce,oe,c+y.shift(),g+y.shift()),c+=y.shift(),g+=y.shift(),Z="C",$.push(c,g);break;case"Q":$.push(y.shift(),y.shift()),c=y.shift(),g=y.shift(),$.push(c,g);break;case"q":$.push(c+y.shift(),g+y.shift()),c+=y.shift(),g+=y.shift(),Z="Q",$.push(c,g);break;case"T":ce=c,oe=g,(se=h[h.length-1]).command==="Q"&&(ce=c+(c-se.points[0]),oe=g+(g-se.points[1])),c=y.shift(),g=y.shift(),Z="Q",$.push(ce,oe,c,g);break;case"t":ce=c,oe=g,(se=h[h.length-1]).command==="Q"&&(ce=c+(c-se.points[0]),oe=g+(g-se.points[1])),c+=y.shift(),g+=y.shift(),Z="Q",$.push(ce,oe,c,g);break;case"A":Ae=y.shift(),Te=y.shift(),_e=y.shift(),Ce=y.shift(),fe=y.shift(),de=c,X=g,c=y.shift(),g=y.shift(),Z="A",$=this.convertEndpointToCenterParameterization(de,X,c,g,Ce,fe,Ae,Te,_e);break;case"a":Ae=y.shift(),Te=y.shift(),_e=y.shift(),Ce=y.shift(),fe=y.shift(),de=c,X=g,c+=y.shift(),g+=y.shift(),Z="A",$=this.convertEndpointToCenterParameterization(de,X,c,g,Ce,fe,Ae,Te,_e)}h.push({command:Z||D,points:$,start:{x:Le,y:st},pathLength:this.calcLength(Le,st,Z||D,$)})}D!=="z"&&D!=="Z"||h.push({command:"z",points:[],start:void 0,pathLength:0})}return h}static calcLength(e,t,i,r){var o,s,h,l,c=pe;switch(i){case"L":return c.getLineLength(e,t,r[0],r[1]);case"C":for(o=0,s=c.getPointOnCubicBezier(0,e,t,r[0],r[1],r[2],r[3],r[4],r[5]),l=.01;l<=1;l+=.01)h=c.getPointOnCubicBezier(l,e,t,r[0],r[1],r[2],r[3],r[4],r[5]),o+=c.getLineLength(s.x,s.y,h.x,h.y),s=h;return o;case"Q":for(o=0,s=c.getPointOnQuadraticBezier(0,e,t,r[0],r[1],r[2],r[3]),l=.01;l<=1;l+=.01)h=c.getPointOnQuadraticBezier(l,e,t,r[0],r[1],r[2],r[3]),o+=c.getLineLength(s.x,s.y,h.x,h.y),s=h;return o;case"A":o=0;var g=r[4],v=r[5],E=r[4]+v,D=Math.PI/180;if(Math.abs(g-E)<D&&(D=Math.abs(g-E)),s=c.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],g,0),v<0)for(l=g-D;l>E;l-=D)h=c.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],l,0),o+=c.getLineLength(s.x,s.y,h.x,h.y),s=h;else for(l=g+D;l<E;l+=D)h=c.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],l,0),o+=c.getLineLength(s.x,s.y,h.x,h.y),s=h;return h=c.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],E,0),o+c.getLineLength(s.x,s.y,h.x,h.y)}return 0}static convertEndpointToCenterParameterization(e,t,i,r,o,s,h,l,c){var g=c*(Math.PI/180),v=Math.cos(g)*(e-i)/2+Math.sin(g)*(t-r)/2,E=-1*Math.sin(g)*(e-i)/2+Math.cos(g)*(t-r)/2,D=v*v/(h*h)+E*E/(l*l);D>1&&(h*=Math.sqrt(D),l*=Math.sqrt(D));var y=Math.sqrt((h*h*(l*l)-h*h*(E*E)-l*l*(v*v))/(h*h*(E*E)+l*l*(v*v)));o===s&&(y*=-1),isNaN(y)&&(y=0);var U=y*h*E/l,ee=y*-l*v/h,ge=(e+i)/2+Math.cos(g)*U-Math.sin(g)*ee,se=(t+r)/2+Math.sin(g)*U+Math.cos(g)*ee,ce=function(de){return Math.sqrt(de[0]*de[0]+de[1]*de[1])},oe=function(de,X){return(de[0]*X[0]+de[1]*X[1])/(ce(de)*ce(X))},Ae=function(de,X){return(de[0]*X[1]<de[1]*X[0]?-1:1)*Math.acos(oe(de,X))},Te=Ae([1,0],[(v-U)/h,(E-ee)/l]),_e=[(v-U)/h,(E-ee)/l],Ce=[(-1*v-U)/h,(-1*E-ee)/l],fe=Ae(_e,Ce);return oe(_e,Ce)<=-1&&(fe=Math.PI),oe(_e,Ce)>=1&&(fe=0),s===0&&fe>0&&(fe-=2*Math.PI),s===1&&fe<0&&(fe+=2*Math.PI),[ge,se,h,l,Te,fe,g,s]}}function Yt(a){return(Yt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(a)}function Xt(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable})),t.push.apply(t,i)}return t}function at(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Xt(Object(t),!0).forEach(function(i){qt(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Xt(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}function vi(a,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(a,i.key,i)}}function Qt(a,e){return(Qt=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(a,e)}function yi(a,e){return!e||Yt(e)!=="object"&&typeof e!="function"?_t(a):e}function _t(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Ct(a){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(a)}function qt(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}pe.prototype.className="Path",pe.prototype._attrsAffectingSize=["data"],K(pe),u.addGetterSetter(pe,"data");var Kt=function(a){(function(h,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(l&&l.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),l&&Qt(h,l)})(s,a);var e,t,i,r,o=(i=s,r=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}(),function(){var h,l=Ct(i);if(r){var c=Ct(this).constructor;h=Reflect.construct(l,arguments,c)}else h=l.apply(this,arguments);return yi(this,h)});function s(h){var l;(function(v,E){if(!(v instanceof E))throw new TypeError("Cannot call a class as a function")})(this,s);var c=(l=o.call(this,h)).generateHash("avatar_container"),g=l.generateHash("avatar_loader");return l.onFileLoad=l.onFileLoad.bind(_t(l)),l.onCloseClick=l.onCloseClick.bind(_t(l)),l.state={imgWidth:0,imgHeight:0,scale:1,containerId:c,loaderId:g,lastMouseY:0,showLoader:!(l.props.src||l.props.img)},l}return e=s,(t=[{key:"generateHash",value:function(h){var l=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return h+"-"+l()+"-"+l()+"-"+l()}},{key:"onCloseCallback",value:function(){this.props.onClose()}},{key:"onCropCallback",value:function(h){this.props.onCrop(h)}},{key:"onFileLoadCallback",value:function(h){this.props.onFileLoad(h)}},{key:"onBeforeFileLoadCallback",value:function(h){this.props.onBeforeFileLoad(h)}},{key:"onImageLoadCallback",value:function(h){this.props.onImageLoad(h)}},{key:"componentDidMount",value:function(){var h=this;if(!this.state.showLoader){var l=this.props.img||new Image;l.crossOrigin="Anonymous",!this.props.img&&this.props.src&&(l.src=this.props.src),this.setState({image:l},function(){if(h.image.complete)return h.init();h.image.onload=function(){h.onImageLoadCallback(h.image),h.init()}})}}},{key:"componentDidUpdate",value:function(h,l){h.src!==this.props.src&&(this.image.src=this.props.src)}},{key:"onFileLoad",value:function(h){if(h.preventDefault(),this.onBeforeFileLoadCallback(h),h.target.value){var l=h.target.files[0];this.onFileLoadCallback(l);var c=this;Vt().getData(l,function(){var g=Vt().getTag(this,"Orientation");mi()(l,function(v,E){c.setState({image:v,file:l,showLoader:!1},function(){c.init()})},{orientation:g,meta:!0})})}}},{key:"onCloseClick",value:function(){var h=this;this.setState({showLoader:!0},function(){return h.onCloseCallback()})}},{key:"init",value:function(){var h,l,c=this.props,g=c.height,v=c.minCropRadius,E=c.cropRadius,D=this.image.width,y=this.image.height,U=y/D,ee=this.props,ge=ee.imageWidth,se=ee.imageHeight;se&&ge&&console.warn("The imageWidth and imageHeight properties can not be set together, using only imageWidth."),se&&!ge?l=(h=se||y)/U:ge?h=(l=ge)*U||y:l=(h=g||y)/U;var ce=h/y,oe=Math.max(v,E||Math.min(l,h)/3);this.setState({imgWidth:l,imgHeight:h,scale:ce,cropRadius:oe},this.initCanvas)}},{key:"initCanvas",value:function(){var h=this,l=this.initStage(),c=this.initBackground(),g=this.initShading(),v=this.initCrop(),E=this.initCropStroke(),D=this.initResize(),y=this.initResizeIcon(),U=new Ie.Layer;U.add(c),U.add(g),U.add(E),U.add(v),U.add(D),U.add(y),l.add(U);var ee=function(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return v.radius()-X},ge=function(X){return v.x()-ee(X)<0},se=function(X){return v.y()-ee(X)<0},ce=function(X){return v.x()+ee(X)>l.width()},oe=function(X){return v.y()+ee(X)>l.height()},Ae=function(X){return ee(X)>=h.minCropRadius?X:v.radius()-h.minCropRadius},Te=function(X){return X+.86*v.radius()},_e=function(X){return X-.5*v.radius()},Ce=function(X,Z){D.x(Te(X)-8),D.y(_e(Z)-8),y.x(Te(X)-8),y.y(_e(Z)-10)},fe=function(){if(h.props.exportAsSquare){var X=new Ie.Image({image:h.image}),Z=X.width()/c.width(),$=X.height()/c.height(),Le=2*v.radius()*Z,st=2*v.radius()*$,ot=h.props.exportSize?h.props.exportSize/Le:void 0;return X.toDataURL({x:(v.x()-v.radius())*Z,y:(v.y()-v.radius())*$,width:Le,height:st,pixelRatio:ot,mimeType:h.props.exportMimeType,quality:h.props.exportQuality})}var qe=2*v.radius(),Oe=2*v.radius(),_i=h.props.exportSize?h.props.exportSize/qe:void 0;return v.toDataURL({x:v.x()-v.radius(),y:v.y()-v.radius(),width:qe,height:Oe,pixelRatio:_i,mimeType:h.props.exportMimeType,quality:h.props.exportQuality})},de=function(X){var Z=X>0||function($){return!(ge($)||ce($)||oe($)||se($))}(X)?X:0;E.radius(E.radius()-Ae(Z)),v.radius(v.radius()-Ae(Z)),D.fire("resize")};this.onCropCallback(fe()),v.on("dragmove",function(){return v.fire("resize")}),v.on("dragend",function(){return h.onCropCallback(fe())}),v.on("resize",function(){var X=ge()?v.radius()+1:ce()?l.width()-v.radius()-1:v.x(),Z=se()?v.radius()+1:oe()?l.height()-v.radius()-1:v.y();Ce(X,Z),v.setFillPatternOffset({x:X/h.scale,y:Z/h.scale}),v.x(X),E.x(X),v.y(Z),E.y(Z)}),v.on("mouseenter",function(){return l.container().style.cursor="move"}),v.on("mouseleave",function(){return l.container().style.cursor="default"}),v.on("dragstart",function(){return l.container().style.cursor="move"}),v.on("dragend",function(){return l.container().style.cursor="default"}),D.on("touchstart",function(X){D.on("dragmove",function(Z){if(Z.evt.type==="touchmove"){var $=Z.evt.changedTouches[0].pageY-X.evt.changedTouches[0].pageY||0;de($*h.mobileScaleSpeed)}})}),D.on("dragmove",function(X){if(X.evt.type!=="touchmove"){var Z=X.evt.y,$=Z?Z-h.state.lastMouseY:void 0,Le=X.evt.movementY||$||0;h.setState({lastMouseY:Z}),de(Le)}}),D.on("dragend",function(){return h.onCropCallback(fe())}),D.on("resize",function(){return Ce(v.x(),v.y())}),D.on("mouseenter",function(){return l.container().style.cursor="nesw-resize"}),D.on("mouseleave",function(){return l.container().style.cursor="default"}),D.on("dragstart",function(X){h.setState({lastMouseY:X.evt.y}),l.container().style.cursor="nesw-resize"}),D.on("dragend",function(){return l.container().style.cursor="default"})}},{key:"initStage",value:function(){return new Ie.Stage({container:this.containerId,width:this.width,height:this.height})}},{key:"initBackground",value:function(){return new Ie.Image({x:0,y:0,width:this.width,height:this.height,image:this.image})}},{key:"initShading",value:function(){return new Ie.Rect({x:0,y:0,width:this.width,height:this.height,fill:this.shadingColor,strokeWidth:4,opacity:this.shadingOpacity})}},{key:"initCrop",value:function(){return new Ie.Circle({x:this.halfWidth,y:this.halfHeight,radius:this.cropRadius,fillPatternImage:this.image,fillPatternOffset:{x:this.halfWidth/this.scale,y:this.halfHeight/this.scale},fillPatternScale:{x:this.scale,y:this.scale},opacity:1,draggable:!0,dashEnabled:!0,dash:[10,5]})}},{key:"initCropStroke",value:function(){return new Ie.Circle({x:this.halfWidth,y:this.halfHeight,radius:this.cropRadius,stroke:this.cropColor,strokeWidth:this.lineWidth,strokeScaleEnabled:!0,dashEnabled:!0,dash:[10,5]})}},{key:"initResize",value:function(){return new Ie.Rect({x:this.halfWidth+.86*this.cropRadius-8,y:this.halfHeight+-.5*this.cropRadius-8,width:16,height:16,draggable:!0,dragBoundFunc:function(h){return{x:this.getAbsolutePosition().x,y:h.y}}})}},{key:"initResizeIcon",value:function(){return new Ie.Path({x:this.halfWidth+.86*this.cropRadius-8,y:this.halfHeight+-.5*this.cropRadius-10,data:"M47.624,0.124l12.021,9.73L44.5,24.5l10,10l14.661-15.161l9.963,12.285v-31.5H47.624z M24.5,44.5   L9.847,59.653L0,47.5V79h31.5l-12.153-9.847L34.5,54.5L24.5,44.5z",fill:this.cropColor,scale:{x:.2,y:.2}})}},{key:"render",value:function(){var h=this,l=this.props,c=l.width,g=l.height,v={display:"flex",justifyContent:"center",backgroundColor:this.backgroundColor,width:c||this.width,position:"relative"},E=this.props.label,D=at(at({},this.props.labelStyle),{lineHeight:(g||200)+"px"}),y=at(at({},this.props.borderStyle),{width:c||200,height:g||200});return Y().createElement("div",null,this.state.showLoader?Y().createElement("div",{style:y},Y().createElement("input",{onChange:function(U){return h.onFileLoad(U)},name:this.loaderId,type:"file",id:this.loaderId,style:{width:.1,height:.1,opacity:0,overflow:"hidden",position:"absolute",zIndex:-1},accept:this.mimeTypes}),Y().createElement("label",{htmlFor:this.loaderId,style:D},E)):Y().createElement("div",{style:v},Y().createElement("svg",{onClick:this.onCloseClick,style:{position:"absolute",zIndex:999,cursor:"pointer",left:"10px",top:"10px"},viewBox:"0 0 475.2 475.2",width:"20px",height:"20px"},Y().createElement("g",null,Y().createElement("path",{d:"M405.6,69.6C360.7,24.7,301.1,0,237.6,0s-123.1,24.7-168,69.6S0,174.1,0,237.6s24.7,123.1,69.6,168s104.5,69.6,168,69.6    s123.1-24.7,168-69.6s69.6-104.5,69.6-168S450.5,114.5,405.6,69.6z M386.5,386.5c-39.8,39.8-92.7,61.7-148.9,61.7    s-109.1-21.9-148.9-61.7c-82.1-82.1-82.1-215.7,0-297.8C128.5,48.9,181.4,27,237.6,27s109.1,21.9,148.9,61.7    C468.6,170.8,468.6,304.4,386.5,386.5z",fill:this.closeIconColor}),Y().createElement("path",{d:"M342.3,132.9c-5.3-5.3-13.8-5.3-19.1,0l-85.6,85.6L152,132.9c-5.3-5.3-13.8-5.3-19.1,0c-5.3,5.3-5.3,13.8,0,19.1    l85.6,85.6l-85.6,85.6c-5.3,5.3-5.3,13.8,0,19.1c2.6,2.6,6.1,4,9.5,4s6.9-1.3,9.5-4l85.6-85.6l85.6,85.6c2.6,2.6,6.1,4,9.5,4    c3.5,0,6.9-1.3,9.5-4c5.3-5.3,5.3-13.8,0-19.1l-85.4-85.6l85.6-85.6C347.6,146.7,347.6,138.2,342.3,132.9z",fill:this.closeIconColor}))),Y().createElement("div",{id:this.containerId})))}},{key:"lineWidth",get:function(){return this.props.lineWidth}},{key:"containerId",get:function(){return this.state.containerId}},{key:"closeIconColor",get:function(){return this.props.closeIconColor}},{key:"cropColor",get:function(){return this.props.cropColor}},{key:"loaderId",get:function(){return this.state.loaderId}},{key:"mimeTypes",get:function(){return this.props.mimeTypes}},{key:"backgroundColor",get:function(){return this.props.backgroundColor}},{key:"shadingColor",get:function(){return this.props.shadingColor}},{key:"shadingOpacity",get:function(){return this.props.shadingOpacity}},{key:"mobileScaleSpeed",get:function(){return this.props.mobileScaleSpeed}},{key:"cropRadius",get:function(){return this.state.cropRadius}},{key:"minCropRadius",get:function(){return this.props.minCropRadius}},{key:"scale",get:function(){return this.state.scale}},{key:"width",get:function(){return this.state.imgWidth}},{key:"halfWidth",get:function(){return this.state.imgWidth/2}},{key:"height",get:function(){return this.state.imgHeight}},{key:"halfHeight",get:function(){return this.state.imgHeight/2}},{key:"image",get:function(){return this.state.image}}])&&vi(e.prototype,t),s}(Y().Component);qt(Kt,"defaultProps",{shadingColor:"grey",shadingOpacity:.6,cropColor:"white",closeIconColor:"white",lineWidth:4,minCropRadius:30,backgroundColor:"grey",mimeTypes:"image/jpeg,image/png",exportAsSquare:!1,exportSize:void 0,exportMimeType:"image/png",exportQuality:1,mobileScaleSpeed:.5,onClose:function(){},onCrop:function(){},onFileLoad:function(){},onImageLoad:function(){},onBeforeFileLoad:function(){},label:"Choose a file",labelStyle:{fontSize:"1.25em",fontWeight:"700",color:"black",display:"inline-block",fontFamily:"sans-serif",cursor:"pointer"},borderStyle:{border:"2px solid #979797",borderStyle:"dashed",borderRadius:"8px",textAlign:"center"}});const bi=Kt})(),Be})()})})(si);var Li=si.exports;const Oi=Si(Li);var ri={VITE_APP_NAME:"TehGroupClient",VITE_APP_VERSION:"v1.0",VITE_BASE_APP_URL:"https://teh-erp-event-crm-dev-f009581783a1.herokuapp.com",VITE_BASE_API_URL:"https://teh-erp-api-dev-a206927ee388.herokuapp.com/api",VITE_CLIENT_APP_URL:"https://teh-erp-client-dev-f009581783a1.herokuapp.com",VITE_MASTER_APP_URL:"https://teh-erp-master-dev-9af9bf8ea050.herokuapp.com",VITE_HR_APP_URL:"https://teh-erp-hr-dev-37843a26b1f5.herokuapp.com",VITE_EVENT_CRM_APP_URL:"https://teh-erp-event-crm-dev-f009581783a1.herokuapp.com",VITE_FINANCE_APP_URL:"",VITE_SALE_APP_URL:"",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ji=({t:ve,editAvatarModal:ye,handleCloseEditAvatar:Se})=>{const we=Ii(),{userInfo:ke}=$t(wi),{isDark:ue}=$t(xi),[Be]=Ke.useState(ke.profileImageUrl?ke.profileImageUrl:void 0),[V,Y]=Ke.useState(),[q,j]=Ke.useState(),{mutate:G}=Ri(()=>{we(ei({isLoading:!0})),we(Pi({userInfo:{profileImageUrl:`https://api.smtprelay.co/userfile/${ri.VITE_ELASTIC_EMAIL_PUBLIC_ACCOUNT_IDENTIFIER}/${q}`}})),Ai.success(ve("text.edit_avatar_success")),Se()},S=>ii(ve,S)),{mutateAsync:K}=Di(S=>{j(S.result.FileName);const C={imageUrl:`https://api.smtprelay.co/userfile/${ri.VITE_ELASTIC_EMAIL_PUBLIC_ACCOUNT_IDENTIFIER}/${S.result.FileName}`};G([ke.userId,C])},S=>ii(ve,S)),re=Ke.useCallback(()=>{if(we(ei({isLoading:!0})),V){const{mimeType:S,extension:C}=Ei(V),O={BinaryContent:V.split(",")[1],Name:`avatar_${ke.userId}_${ki().format("YYYY-MM-DD_HHmmss")}.${C}`,ContentType:S};K(O)}},[V]),L=()=>{Y("")},N=S=>{Y(S)};return Ge.jsx(ti,{show:ye==="open",size:"md",onClose:Se,children:Ge.jsx(ti.Body,{className:"dark:bg-gray-800 rounded-lg",children:Ge.jsxs("div",{className:"flex flex-col items-center justify-center w-full gap-y-4",children:[Ge.jsx(Oi,{width:350,height:300,onCrop:N,onClose:L,src:Be,labelStyle:ue?{color:"#FFFFFF"}:{color:"#000000"}}),Ge.jsxs("div",{className:"grid grid-cols-2 gap-x-4",children:[Ge.jsx("button",{className:"btn-primary",onClick:Se,children:ve("label.close")}),Ge.jsx("button",{className:`${V?"btn-warning":"btn-disable"} w-full lg:w-min whitespace-nowrap`,onClick:re,disabled:!V,children:ve("label.save")})]})]})})})};export{ji as default};
